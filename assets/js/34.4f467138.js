(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{343:function(s,t,a){s.exports=a.p+"assets/img/image-20231224142933451.2de3f2c8.png"},344:function(s,t){s.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAnoAAABBCAIAAADJ6p4cAAAWxElEQVR4nO2dXUgb2dvAz//lheq00kp3CsoS+hHpgN3MQsomAVkTLCWK0r1wumUvTOPe2Cpr0QuzS4uI0MYLC138utla92JR0htp0bBUon+ERFBouloGtFbmQtnOFlvE0N69Fw973ulkMpmMGT/q87uaTE6e8zWZ5zzPec45/zl27BhBEARBEMRK/mevC4AgCIIgnz+obhEEQRDEclDdIgiCIIjloLpFEARBEMtBdYsgCIIgloPqFkEQBEEsB9UtgiAIglgOqlsEQRAEsRxUtwiCIAhiOahuEQRBEMRyUN0iCIIgiOX8714XAEH2kunpaULI5ORkT0+PTrKhoSGO45R3wuFwNBrNKp9l2cbGxtXV1UgksgvlPOR8Zq1k+qnTJ++tZLycFtXooKBWtyzL1tbWulwuaBSdLvH7/dXV1WVlZQzDEEIkSVpaWnr48KEsyzRNeuOmMzIyMjw8bKLowWDQ5/PZbDaa+86fnrzLNN6epoWfP3++tLTUZrP19/er3ul+v9/r9Z47d45lWUJIKpV68eLF+Ph4PB6naXLtI5Zlb968eeHCBaXM6enpw/OfyYnu7m7avDvUuAiCHGg+UbcdHR3V1dVZf8Oy7O3bt3meV9602Ww2m628vLyhoSGnEjx9+jSn9EA4HHa73TvP3VKZBtvTtPDKykoY6wBnz56l1yzLtre3K6tDCGEYxu12u93un3/+Walxs0L7yOPx3LlzR5kplVlSUmJu2HQgGBkZOX78OCHEbrfX19cb/yEM3cinvbOvGBoaIoTMzc3tSfftbe77HNNP3S5jvJwHpUYW8Ym6PXPmDFwkk8nS0lIwX9K5efMm6FpZlmdmZlZWVoqKiqqqqjiOs9lsLS0tfX19yvSSJP3xxx8qIaFQCDJSWsMGaWlpAUUiiuLU1BQhpKKigud5m83W0dFhzny0QqbB9swVlmV7e3vpezyZTK6vryeTybW1NZrG6/VCdWgfEUKqq6uh465du6ZStwb7qK2tDXRtLBabm5sjhLhcLp/PRwgRBOHp06cmevNAQJvL7/fn9MNIJBIIBCRJevjwoQXlygNgfL9+/foQ5r7PMf3U7TLGy3lQamQRn6jbxcXFqakpcHkNDQ1lUg8DAwPnzp1bX1+H1zEQiUQikQjLshcuXFClT6VSKk9jMBiEi+fPn5sodGVlJSFEluWmpiaaOzhFKysrzalGK2QabM9c6e7uBl2bTCYHBwdFUUxPE4lEjh07durUKWXJo9Eo1KisrEyV3kgfBYNBqMLjx4/piCoajUqSFAgEGIapra0FGwUmGmZnZ9F9Ojw8jHYbgiBEpW5VVmkmZFlub29Pt2MWFxfpxKc+X3/9NVyY8CR7PB546U9MTCjvT01NcRzHMIzf7891HtEKmcRwe+ZEMBgEgyCRSCiHO+lovuU3NjY4jpMkKWtG6X106tQpuFDVa3h4WBAEhmGUXc/zPM/zV69enZ+fHx8f1xwTIAiCHB5MRiZr+gw/fPhg5Lcsy4JL05wn2el0woXKHTo9Pd3c3EwI4Xk+V9VohUxzwOQoIaS7u1tzehU8t7Is6+taTViWdblchBDwA+unTO8j8I1rKk5JkjiOKykpgY9ra2uSJNlsNpZlq6urq6urk8nkzo1diKgMh8NFRUV1dXU0oi0WiynHFn6/HxpHFfQIlr0oitSBoSQYDNbU1MCoSxTFncwmas7Ze71ezcQcx33//fclJSU2m005KZ5pOCUIgrLuT548MdGqtIko0E06BYYQ6/LycshaluXFxcWBgYH0v3DWGpnInRAiCEJFRQWNzZRl+dWrV48ePdJ8ILO2ksfjuXfvHlynUilJkhYXF8fGxtKrk+mpS5dpPGVO7WkdRp6lvS1neu7z8/OqgNwDRD4XAsHrWGk5wcT4+/fvlclqa2vhwpwn+ejRo3ABfzN4P8qyLMtyKpViGKagoGA/yDTHtWvX4G0SCATS1S3MjhNCZmZm4EGENv/48ePz58/11QOoE4ZhVMrJeB+BZazpvVDFNoui2NDQAK9diGHOo7GrCrKw2WyBQOD8+fMmxh+U0tJS5eue4ziO43Yo0wh+v/+nn35S6iTKiRMn0m8WFxfD+A+w2Wzw0WqnvSpcAO74fD6Xy9XW1qbszVxrZBBVGCMUgGVZh8ORPjA10koQsAMwDAM9XlNTk2mYm/7UZWp5IymNt6d1GGmlvS2nZu7V1dXl5eWa7tX9T97ULcuy6VEPmg/uTjzJhBCl5hMEAR4RWKmisrH2VqY51tfXwazc2NhI//b06dNw8ffff6seRJ7nNdVDMBh0uVxgZ4ii+Ntvv6nMdON99PbtW0IIwzDBYFCpsDs6OjTrIopiV1cXIUQQBKfT6XA4lMZua2trpkbQp76+PpFIgFnDcdwvv/xis9ncbrc5hz9QVlamlHnjxg2e591utyAIJjTZ+Ph4MpmEaxqzpskPP/xAQ89evny5tbVFvyoqKkpP73A4EolEb2+vLMtUsdXV1eVayIWFhXA4DNfwzCQSCTDONKHhAjQZz/MQGH/r1i2lt8BIjXLNvaOjQxX3V1RU5HQ63W43wzCXL19WPcNGWklZBrvd/uWXXzocDoZh7ty5EwgE0l/lNTU1EES5tbXF8zwMzjRb3khK4+1pHUZaaW/L2d7eToNUZmdnt7a2INjTZrN1d3fvTivll7yp28bGRrgYHx/XSbZDTzIhRKn5qqqq4MLlcu0kIMUKmebo6enZ3t4mGeZ96eIrp9NZWFg4OTlJCCkoKHC5XLAgJ13lnD9/npqeHMf9+OOPRUVF+m/nTH307NkzGLaDNbm5uUkIOXPmzMePHyHBu3fvNAXSMLrGxkZ4+6hWkeWE0pEuimJ7e/vIyAjDMF6v17S6lSRJKbO1tRUKXFFRYULdiqJIB/76NaXvMhiXZOWff/6h5YxGo/A2NxItoUKWZdpWIHBzczNT64HlR9JC5JLJZCgUgm9pfY3UKKfcWZaFMEZJkpQ2TSQSEQSBaNmXRlpJWQYA3MvwIKXL3N7epu/3aDRaUFCQKU4la8qc2tM6srbS3paTZVm6VIQOzaPR6IMHD3ie37VWyi/52cTR4/HAazQWi+k3wQ49yeTTdzq1pDVtwb2VaZq+vr6sMVaFhYWCIPT09PT09HR1dXV3d8P99BmvUCjk9XqbmppGRkZEUWRZtrm5mUYda5Kpj0RRHBkZgWu32w12qs1mGx0dhZuggNNhWTYYDHZ3d1OHbSqV0q+gDvPz88qPsiwvLy8TQkpLS03LTF+I8urVK0LIkSNHTMs0AigPh8PR2dkpCELW2PWlpSVLy6PJpUuXCCGpVEr1WFJ1RZ0uJPcaZcXpdIK5/OTJE9UAHYZx6T/JqZU8Ho/f7/f7/bBYjmRYIa166nTiVLKmzKk9rSNrK+1tOWk8DSzLpMzOzsKFx+OxLneLyIN1S6N7JEkaGBjQTwxeylQqZc6TTD59p/f09IDXDp6AkydPksw21i7LtJTBwUHlx3g8Dl7QTNNjYG8NDw/D2FAQBB3DXaePhoeHNzY2vF4vZLSxsTE2NvbVV1/Bt9SDSgE3stKbusMoJE3AA2/CyNMh09Ahv9y/f7+trQ3mw3w+X3NzsyRJr169Ghsb2z8jd4hsYBhGx99LyXuN7HY7XPz1118mfp4Jj8dz7dq1nXhZTJNTe+4he1tO2u/K+QiieAzoQokDxE7VLd1mSOXq0YR6KV+8eGF6oht8rYQQcCYoPUIwlDbxorRCpqWYfhdPTk7yPM8wjMfj0Zy1zdpH0WhU5YW7ceMG+XTlrmqjR/h2bm5uX2kRfegWJZYSj8cFQYBBCey1CXuZ+Xy+A7rxr3U1Ki4uzlchlZujybJMgxLyO2JDEBU7UrctLS0wmWdE1xKFl3JhYcF0ptTn4/F4lO9umMghhKyuru4HmVagGhYov9KMBdVBGZmpJNc+CgaDoJ5nZmboTafTCQuWiDXmrAp4ERtZTGwQUBJktyYUqFOUZVmv1wtrM6qrq/fJeuU3b97AhSAIBkfJeawR/W9yHJfTzqM6QPy/JEl3795Vlmd3zDgT7bkn7G05ab+rYgapL40W7wBhcu7W4/EMDQ2Brk0kEgbDsqmXMmv4SUtLS0tLi+ZX0WgUZv7oCx2AECcd4bss0zQ6MqkKvHLlivK+x+MxqB7o7GkmbWq8j1iW7ejoCAQChJD0TQpTqVQsFmtqampqasqvrr148aKqGA6Hg2h5IJQRcDTuwwjt7e0wfPnzzz9VX9F2gxXM+UWW5UgkEovF4OPuzOEBOtY8VXK3b9/OdS7WYI10cqf/TUEQjPegPjA+W1paUuraXZsLNNGelj51mbC0nFlT0gQ0dhWoqKhQFe8A8Yl1q9zHEl43xcXF9ObCwgLoVOUK8WQyOT09Tae1gbW1tfQxrNJLqV8mukvAyZMnNeMbZ2ZmIEhnaGiI7m8Mf0WljbXnMg22p3GZ8XhclmVYTlNcXLywsACLDSB0M5VKjY2N0cRDQ0OvX79eXV2FyQ+73f7NN9+AVhZFUXN4lLWPWJZ1Op08z5eWlio3HBgcHFQKXFhYqKmp0ZSwc44ePRoOh5ULgaAYNIaC/lHBObGxsVFSUkIHUrDIMpONBdtPQiPEYrH0vzSsxoYNQ1paWmAMzvN8MpkEXzo0EU1PXaDKh4F63WENlXLOm/YmIUS5CbZ1JJNJCPV88OABLLcghNjt9mfPnkEriaIYi8V8Ph/P8wMDA/Pz87TAdrt9ZWVFObmQa42y5k7+/W8yDHP//v25uTm6vqioqOjs2bMmHNSgv8vLy+FJgJO1BEGAJ6q4uNjSqNec2hPI+tQduHJmTSnLciKRcLvdymeD/jeVwf8HiE/UbfqqTTjsBa7pHj1KPyRsX6D61eTkZHpbGPdS0hDTTKtde3p6SktLaTg4va+zEfyeyDTYnjnJvH//Pkw7KUUBkUiENjv3L+kSJEmC0LZ0svaR0+lUVYou3VPetNT19OLFC4fDASfJKItBzXFZlicnJ+EFDcY33IQ3O4yoVPOI6bsaxWKxTEtZZmZm6uvrGYZRHWkCvZneRIDyJu13yFTz2KisQf75YnR0FEZO6f9lWoCurq7CwkK3201XTivLqXyMc62Rkdx7enqKi4thlS1EYCmTmVC3sDkrPAn0piRJr1+/5jgO/lmWzp0bb0+K/lN3EMuZNWVvby/sLqB6NnTeYPuc3Tte3riXEv6BhBC67CSd1tbWlpYWaq5lPZt2r2TmSlaZ8Xi8ra3t+vXr9BTbTLvZJRKJEydOUI2bSqWWl5f1N5/K2kew+ZQkSZubm8vLy0oTZNfY3Nz89ddff/jhB51uguXLlZWV0ERwlsOVK1fSh4aw2ST9KIoihFvr1AvWRVDhsAVgelR2VsCEUu10KEnS+vr6bp4fnP5EEUJkWaaBAkAoFALTX3m2lWpcZaJGOeWuPLyZ/NvymYL+dIDHm+5fCP+g3t5eunnALmCkPZXk66nbP+XMmhI25/+cNnH8z7Fjx/a6DAhiCIhkOaAhuwiCHHLys80FgiAIgiA6oLpFEARBEMtBdYsgCIIgloPqFkEQBEEsB0OlEARBEMRy0LpFEARBEMtBdYsgCIIgloPqFkEQBEEsB9UtgiAIgliO3iaOHMddv369tLTUZrOJotjU1LRrxfo8GBoa4jgOtojbzW35EARBkP1GRnVLj6bJCsuyjY2Nq6urWTdDPpywLMuyrNvtdrlcmXa9RxAEQT5vtBcCdXZ2wrEbkiQ9efJkenpaZ0tosOEIIf39/ahxVcDx2lVVVdBEiURC87iYXGXW1ta6XC6QiXsIIwiC7H80rFu/3w+61qBuoAeqnD17ducFgiOx5ubm8nsm+V4Bx2tHIpFwOAwHewmCsJNBiXGvA4IgCLJ/0AiV+u677wghsiz39vYaEQHKQ+dc2JyAU1pPnTq1c1H7ilAoBB6Cq1ev7kTOmTNn4CKZTB7QU6gQBEEOIWp16/F4wEU5MTFh8G0+PDzs9XobGhrw7a/PxMQEIYRlWY/HY1rI4uJif3+/1+ttbW19+/Zt/kqHIAiCWIha3TqdTrh4+vTprhfmM4c26bfffmtaSF9fH06QIwiCHDjUc7dlZWWEEEmS9E1VzRlEr9ebnhKOBA+Hw0VFRXV1dTDRCxFYVG34/X7VJHF1dbVKvko4hEOXl5eDQFmWFxcXBwYG0osdDAZ9Pp8y362tLcjOhExlxWFxlCAItF7JZHJ0dDQej2s2mizLoihyHEcdwgiCIMghQa1ujxw5QghJpVL5zcZut9fX19OPNputubmZ/Dvvmyssy/b29tIQLbjj8/lcLldbW5soivQ+DbFW5js5ObkTmUppHMdBRQCe58vKygKBQKbByrt37wghDMPkUFsEQRDk4KO97nZjY0P/Z+Pj48lkEq69Xq/b7dZPX1NTI4ri1NTU1tYWz/NgINbV1YG6XVhYCIfDkBLszkQiAWaxJt3d3aAXaTKe5ysrKxmGuXXrFt2Ow+Px0OVMg4OD8XgcNu6orKw0LRMqDqMHhmGuXLmSSCQePXokimIwGAwEAgzD1NbWZgqr3tzcJIpYbgRBEOSQoK1uP3z4oP8zURSpwcfzfNZstre3qcaKRqMFBQXUwUsIkWWZ7rgE6nZzczPTHkwQukwIefz4cV9fH5WZTCZDoRB8C2W7fPkyfHv37l24I4piKBT6/fffVQrPuEyouN/vhzQXL14UBAGuh4eHA4EAIeTzC6tGEARBdsgu7Zk8Pz+v/JhVnetw6dIlQkgqlaJ6EaDq+fTp03BRUlJCPh0ZAEtLS6ZlqpiZmVF+9Hq9Xq8XN51AEARBVGhbt/s5lufo0aOEEIZhdLzNSrI6xk3IpKysrOSUvqCggBCCK6YQBEEOG2rr9uPHjwRjeSwDDG5cL4sgCHLYUFu36+vrPM/v51ieN2/ewIUgCEbMRNBw+ZVpGmhYIwY3giAI8jmhtm7/+9//wkUwGNz1wvw/Ot5suqr19u3bLMvqCIFVNxzHqZKVl5eblrkTBEEAt8HLly8tygJBEATZn6it23g8Lssyy7IulyvTahaWZenmU4SQ4uJiuKDxukQRZJQryWSS53mO4x48eDA7O7u1tUUIsdvtz549o7HBsVjM5/PxPD8wMDA/P0+XJNnt9pWVFZr19PQ0rFDq7e1VLgT64osvVJkalwl1tNvt9Fu4s7CwkNUsrqqqIoSkUqmdbAulbGRQ3sXFxfSmkWIgCIIgu49GqNTExEQgEOA4rqWlRRWpCzidTs2TgpQ3Tavb0dHRsrIyhmF4nlctMaIBxl1dXYWFhW63m2VZ1f5TsViMZh2NRmFNsM1mu3fvHk2TSCTSFwoblKmqON27IxwO61c5GAzCWiNVMHOupLc8HDRksBgIgiDInqCxEGh4eBgUW319fWdnp3XOVU3i8XhbW1sikVBaabIsb29vK5OFQqFwOKw6FSfdsAuFQiMjI5IkwUdJkvr7+2GviXQMyswVlmU7OjpgSa4kSbhMCEEQ5BCifby8akdDURQ3Nja6urp2t2xWAUfPplKpmpoaSzPq7OwsKSkBo5YQIklSe3s7OnsRBEEOIdrbXMiy3NDQMDIyArqB4zgj8b0HAo/H43A4CCHLy8tW50V1rSzLk5OTeEYhgiDIoUXbulXCcdzp06ffv3+f6aCb/YwysMhut588edLlckGE0S5Mc3o8nuPHj6+trWmecIAgCIIcHrKr2wON5i5REBucKe4aQRAEQfKO9iaOnw2pVIrukCVJUiqVWlxcpGuKEARBEGR3+MytWwRBEATZD/wfaYHr1y3z490AAAAASUVORK5CYII="},416:function(s,t,a){"use strict";a.r(t);var n=a(14),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"redis-发布订阅-pubsub"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis-发布订阅-pubsub"}},[s._v("#")]),s._v(" Redis 发布订阅：PubSub")]),s._v(" "),t("p",[s._v("Redis 实现了发布订阅模型，有三个角色：发布者，订阅者，频道。")]),s._v(" "),t("p",[s._v("频道用以解耦双方通信，订阅者通过订阅频道获取信息，发布者通过频道知道自己需要把信息发到哪。")]),s._v(" "),t("p",[s._v("频道也可以理解为消息类型，唯一确定某一类消息。")]),s._v(" "),t("h2",{attrs:{id:"pubsub快速入门"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pubsub快速入门"}},[s._v("#")]),s._v(" pubsub快速入门")]),s._v(" "),t("h3",{attrs:{id:"_1、基本pubsub模型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、基本pubsub模型"}},[s._v("#")]),s._v(" 1、基本pubsub模型")]),s._v(" "),t("h4",{attrs:{id:"发布消息-publish"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#发布消息-publish"}},[s._v("#")]),s._v(" 发布消息：publish")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("PUBLISH "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("channel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("message"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"订阅消息-subscribe"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#订阅消息-subscribe"}},[s._v("#")]),s._v(" 订阅消息：subscribe")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("SUBSCRIBE "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("channel1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("channel2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"取消订阅-unsubscribe"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#取消订阅-unsubscribe"}},[s._v("#")]),s._v(" 取消订阅：unsubscribe")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("UNSUBSCRIBE "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("channel1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("channel2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("img",{staticStyle:{zoom:"67%"},attrs:{src:a(343),alt:"image-20231224142933451"}}),s._v(" "),t("img",{staticStyle:{zoom:"67%"},attrs:{src:a(344),alt:"image-20231224142923210"}}),s._v(" "),t("h3",{attrs:{id:"_2、模式匹配相关"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、模式匹配相关"}},[s._v("#")]),s._v(" 2、模式匹配相关")]),s._v(" "),t("p",[s._v("客户端可订阅 glob 样式的模式，以接收发送到与给定模式匹配的通道名的所有消息。")]),s._v(" "),t("h4",{attrs:{id:"订阅模式-psubscribe"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#订阅模式-psubscribe"}},[s._v("#")]),s._v(" 订阅模式：psubscribe")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("PSUBSCRIBE news.*\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"取消订阅模式-punsubscribe"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#取消订阅模式-punsubscribe"}},[s._v("#")]),s._v(" 取消订阅模式：punsubscribe")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("PUNSUBSCRIBE news.*\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"_3、分片相关-sharded-pub-sub"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、分片相关-sharded-pub-sub"}},[s._v("#")]),s._v(" 3、分片相关：Sharded Pub/Sub")]),s._v(" "),t("p",[s._v("分片相关在 Redis 7.0 引入。")]),s._v(" "),t("p",[s._v("全局 pubsub 存在着广播风暴问题，即在集群中的一个节点发布了一条消息，需要广播给集群的所有其它节点。")]),s._v(" "),t("p",[s._v("Sharded Pub/Sub 对 shard channels 做了与 key 一样的分片计算。即在 shard channels 上发布的消息必须发给拥有该 channel 对应的 slot 的节点，而订阅者只需要和该节点及其从节点建立连接，即可收到消息。")]),s._v(" "),t("p",[s._v("Sharded Pub/Sub 不会在集群的节点间进行无效的广播，从而提高性能。")]),s._v(" "),t("h4",{attrs:{id:"发布-spublish"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#发布-spublish"}},[s._v("#")]),s._v(" 发布：spublish")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("PUBLISH "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("channel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("message"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"订阅-ssubscribe"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#订阅-ssubscribe"}},[s._v("#")]),s._v(" 订阅：ssubscribe")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("SSUBSCRIBE "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("channel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"取消订阅-sunsubscribe"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#取消订阅-sunsubscribe"}},[s._v("#")]),s._v(" 取消订阅：sunsubscribe")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("PUNSUBSCRIBE [channel]\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"一条消息-多次匹配"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一条消息-多次匹配"}},[s._v("#")]),s._v(" 一条消息，多次匹配")]),s._v(" "),t("p",[s._v("一条消息，可能既与满足模式匹配，也满足基本模型的匹配，就会收到两条消息。")]),s._v(" "),t("p",[s._v("举个例子，如果订阅了：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("SUBSCRIBE foo\nPSUBSCRIBE f*\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("然后收到一个来自 foo 频道的消息，会同时收到两条消息。")]),s._v(" "),t("p",[s._v("一个 message ，一个 pmessage")]),s._v(" "),t("h3",{attrs:{id:"消息传递模型-at-most-once"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#消息传递模型-at-most-once"}},[s._v("#")]),s._v(" 消息传递模型：at-most-once")]),s._v(" "),t("p",[s._v("pubsub的消息至多传递一次，容易丢失，不可靠。")]),s._v(" "),t("h2",{attrs:{id:"pubsub实现原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pubsub实现原理"}},[s._v("#")]),s._v(" pubsub实现原理")]),s._v(" "),t("h3",{attrs:{id:"维护频道-哈希表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#维护频道-哈希表"}},[s._v("#")]),s._v(" 维护频道：哈希表")]),s._v(" "),t("p",[s._v("Redis 用dict 来维护所有的频道，key：频道的名称，value：频道的订阅者")]),s._v(" "),t("div",{staticClass:"language-C line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-c"}},[t("code",[s._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 三种 dict 分别对应三种 pubsub")]),s._v("\n    dict "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("pubsub_channels"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n    dict "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("pubsub_patterns"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n    dict "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("pubsubshard_channels"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  \n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" notify_keyspace_events"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* Events to propagate via Pub/Sub. This is an xor of NOTIFY_... flags. */")]),s._v("\n                                   \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("Redis启动时，在initServer中，会对它们做初始化，如下：")]),s._v(" "),t("div",{staticClass:"language-c line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-c"}},[t("code",[s._v("    server"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pubsub_channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("dictCreate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("keylistDictType"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    server"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pubsub_patterns "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("dictCreate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("keylistDictType"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    server"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pubsubshard_channels "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("dictCreate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("keylistDictType"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"频道的来源-subscribe"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#频道的来源-subscribe"}},[s._v("#")]),s._v(" 频道的来源：subscribe")]),s._v(" "),t("p",[s._v("subscribe 对应的实现函数是 subscribeCommand")]),s._v(" "),t("p",[s._v("除了订阅频道的作用，如果要订阅的频道不存在，会创建频道（publish 不会创建频道）")]),s._v(" "),t("div",{staticClass:"language-c line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-c"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("pubsubSubscribeChannel")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("client "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" robj "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("channel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pubsubtype type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    dictEntry "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("de"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    list "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("clients "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" retval "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 客户端维护订阅的频道")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("dictAdd")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("clientPubSubChannels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("channel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" DICT_OK"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        retval "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("incrRefCount")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("channel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        de "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("dictFind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("serverPubSubChannels"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" channel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Redis Server 端不存在该频道 创建")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("de "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            clients "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("listCreate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("dictAdd")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("serverPubSubChannels"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" channel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" clients"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("incrRefCount")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("channel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            clients "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("dictGetVal")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("de"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 将该 client 加入订阅列表")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("listAddNodeTail")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("clients"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 返回该客户端订阅的频道数量")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addReplyPubsubSubscribed")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("channel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" retval"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("h3",{attrs:{id:"publish-发布消息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#publish-发布消息"}},[s._v("#")]),s._v(" publish：发布消息")]),s._v(" "),t("p",[s._v("publish对应的实现函数是 publishCommand")]),s._v(" "),t("div",{staticClass:"language-c line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-c"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 查找频道是否存在")]),s._v("\nde "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("dictFind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("server"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pubsub_channels"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("channel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("de"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//频道存在")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//遍历频道对应的订阅者")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//向每个订阅者发送要发布的消息")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ln "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("listNext")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("li"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            client "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("c "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ln"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v("value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("addReplyPubsubMessage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("channel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("message"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("messageBulk"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("updateClientMemUsageAndBucket")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ... shared pubsub")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ... 查找模式匹配的频道")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("h2",{attrs:{id:"pubsub应用场景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pubsub应用场景"}},[s._v("#")]),s._v(" pubsub应用场景")]),s._v(" "),t("h3",{attrs:{id:"哨兵间通信"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#哨兵间通信"}},[s._v("#")]),s._v(" 哨兵间通信")]),s._v(" "),t("p",[s._v("哨兵的通信机制是基于 pubsub 实现。例如：“sentinel:hello”频道，就是哨兵发现彼此存在的频道。")]),s._v(" "),t("h3",{attrs:{id:"监控"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#监控"}},[s._v("#")]),s._v(" 监控")]),s._v(" "),t("p",[s._v("基于 pubsub ，我们可以监控服务端的特定行为。")]),s._v(" "),t("h2",{attrs:{id:"pubsub的潜在问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pubsub的潜在问题"}},[s._v("#")]),s._v(" pubsub的潜在问题")]),s._v(" "),t("h3",{attrs:{id:"不可靠性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#不可靠性"}},[s._v("#")]),s._v(" 不可靠性")]),s._v(" "),t("p",[s._v("pubsub的消息传递模型是至多一次，不会对消息做持久化，因此出现连接断开时，消息会丢失")]),s._v(" "),t("p",[s._v("如果需要保证可靠，请考虑 Redis Stream。")]),s._v(" "),t("h3",{attrs:{id:"订阅客户端的限制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#订阅客户端的限制"}},[s._v("#")]),s._v(" 订阅客户端的限制")]),s._v(" "),t("p",[s._v("在 RESP2 中，订阅频道的客户端除了订阅等命令不能发出其它命令，只能通过 Ctrl-C 退出。")]),s._v(" "),t("p",[s._v("Redis6.0 推出的 RESP3 已经解决了这个问题。你可以通过HELLO 3 切换到 RESP3 协议。")])])}),[],!1,null,null,null);t.default=e.exports}}]);