<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>注解 | lun&#39;s blogs</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/blog/favicon.ico">
    <meta name="description" content="blog">
    
    <link rel="preload" href="/blog/assets/css/0.styles.56f5eb6c.css" as="style"><link rel="preload" href="/blog/assets/js/app.7b9df32b.js" as="script"><link rel="preload" href="/blog/assets/js/2.be714ec7.js" as="script"><link rel="preload" href="/blog/assets/js/1.26c7c9cc.js" as="script"><link rel="preload" href="/blog/assets/js/50.c900e52a.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.0d71bf2e.js"><link rel="prefetch" href="/blog/assets/js/11.cc81c248.js"><link rel="prefetch" href="/blog/assets/js/12.5e69cd14.js"><link rel="prefetch" href="/blog/assets/js/13.f0bc7bf2.js"><link rel="prefetch" href="/blog/assets/js/14.0188e855.js"><link rel="prefetch" href="/blog/assets/js/15.48a1e71e.js"><link rel="prefetch" href="/blog/assets/js/16.0f4182c9.js"><link rel="prefetch" href="/blog/assets/js/17.ec7b8f9d.js"><link rel="prefetch" href="/blog/assets/js/18.776522e2.js"><link rel="prefetch" href="/blog/assets/js/19.26561e06.js"><link rel="prefetch" href="/blog/assets/js/20.3e42feda.js"><link rel="prefetch" href="/blog/assets/js/21.fd4e7a00.js"><link rel="prefetch" href="/blog/assets/js/22.b59f6079.js"><link rel="prefetch" href="/blog/assets/js/23.e6b2d3ec.js"><link rel="prefetch" href="/blog/assets/js/24.736cfa99.js"><link rel="prefetch" href="/blog/assets/js/25.91176041.js"><link rel="prefetch" href="/blog/assets/js/26.146e299c.js"><link rel="prefetch" href="/blog/assets/js/27.56a57551.js"><link rel="prefetch" href="/blog/assets/js/28.13a846a1.js"><link rel="prefetch" href="/blog/assets/js/29.f71b59d6.js"><link rel="prefetch" href="/blog/assets/js/3.f34ea2f7.js"><link rel="prefetch" href="/blog/assets/js/30.bf0626f9.js"><link rel="prefetch" href="/blog/assets/js/31.47592684.js"><link rel="prefetch" href="/blog/assets/js/32.63f20fc3.js"><link rel="prefetch" href="/blog/assets/js/33.4852d9ec.js"><link rel="prefetch" href="/blog/assets/js/34.4f467138.js"><link rel="prefetch" href="/blog/assets/js/35.17d26444.js"><link rel="prefetch" href="/blog/assets/js/36.d0059312.js"><link rel="prefetch" href="/blog/assets/js/37.fc856e5d.js"><link rel="prefetch" href="/blog/assets/js/38.dc6b373c.js"><link rel="prefetch" href="/blog/assets/js/39.f04e5b6a.js"><link rel="prefetch" href="/blog/assets/js/4.885368ff.js"><link rel="prefetch" href="/blog/assets/js/40.b378efa5.js"><link rel="prefetch" href="/blog/assets/js/41.3c800d8a.js"><link rel="prefetch" href="/blog/assets/js/42.8b804f0c.js"><link rel="prefetch" href="/blog/assets/js/43.832aa078.js"><link rel="prefetch" href="/blog/assets/js/44.d1121c11.js"><link rel="prefetch" href="/blog/assets/js/45.b3e8ede1.js"><link rel="prefetch" href="/blog/assets/js/46.01e4202b.js"><link rel="prefetch" href="/blog/assets/js/47.489850e9.js"><link rel="prefetch" href="/blog/assets/js/48.3bd88d5f.js"><link rel="prefetch" href="/blog/assets/js/49.08c6f759.js"><link rel="prefetch" href="/blog/assets/js/5.d1dbc0b1.js"><link rel="prefetch" href="/blog/assets/js/51.a59d8fbf.js"><link rel="prefetch" href="/blog/assets/js/52.0c715d23.js"><link rel="prefetch" href="/blog/assets/js/53.07715a2f.js"><link rel="prefetch" href="/blog/assets/js/54.e0d8cc69.js"><link rel="prefetch" href="/blog/assets/js/55.1efa3b0b.js"><link rel="prefetch" href="/blog/assets/js/56.ace3e6e3.js"><link rel="prefetch" href="/blog/assets/js/57.221667c1.js"><link rel="prefetch" href="/blog/assets/js/58.a786e5bd.js"><link rel="prefetch" href="/blog/assets/js/59.8a6dde26.js"><link rel="prefetch" href="/blog/assets/js/6.7ee6eed6.js"><link rel="prefetch" href="/blog/assets/js/60.0192f277.js"><link rel="prefetch" href="/blog/assets/js/61.75813485.js"><link rel="prefetch" href="/blog/assets/js/62.d8de1a01.js"><link rel="prefetch" href="/blog/assets/js/63.a08485a4.js"><link rel="prefetch" href="/blog/assets/js/64.7d19f572.js"><link rel="prefetch" href="/blog/assets/js/65.3f290d9a.js"><link rel="prefetch" href="/blog/assets/js/66.73f49082.js"><link rel="prefetch" href="/blog/assets/js/67.cb22e678.js"><link rel="prefetch" href="/blog/assets/js/68.22dc7228.js"><link rel="prefetch" href="/blog/assets/js/69.1f450482.js"><link rel="prefetch" href="/blog/assets/js/7.153b9c62.js"><link rel="prefetch" href="/blog/assets/js/70.03205c0b.js"><link rel="prefetch" href="/blog/assets/js/71.5b98edf5.js"><link rel="prefetch" href="/blog/assets/js/72.8be00756.js"><link rel="prefetch" href="/blog/assets/js/73.5e60394c.js"><link rel="prefetch" href="/blog/assets/js/74.a1100b64.js"><link rel="prefetch" href="/blog/assets/js/75.b47153bc.js"><link rel="prefetch" href="/blog/assets/js/76.b881f0b9.js"><link rel="prefetch" href="/blog/assets/js/77.eef60dd8.js"><link rel="prefetch" href="/blog/assets/js/78.b52fa32f.js"><link rel="prefetch" href="/blog/assets/js/79.9adc486f.js"><link rel="prefetch" href="/blog/assets/js/80.10b21516.js"><link rel="prefetch" href="/blog/assets/js/81.12c11cbc.js"><link rel="prefetch" href="/blog/assets/js/82.df4ae15b.js"><link rel="prefetch" href="/blog/assets/js/83.078b9ed6.js"><link rel="prefetch" href="/blog/assets/js/84.2d8ccb46.js"><link rel="prefetch" href="/blog/assets/js/85.4d5e44f4.js"><link rel="prefetch" href="/blog/assets/js/86.c32dda95.js"><link rel="prefetch" href="/blog/assets/js/87.c28d1f54.js"><link rel="prefetch" href="/blog/assets/js/88.c06457bb.js"><link rel="prefetch" href="/blog/assets/js/89.1febc082.js"><link rel="prefetch" href="/blog/assets/js/90.37985dbe.js"><link rel="prefetch" href="/blog/assets/js/91.9c3ebd93.js"><link rel="prefetch" href="/blog/assets/js/vendors~docsearch.02634ae8.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.56f5eb6c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/logo.png" alt="lun's blogs" class="logo"> <span class="site-name can-hide">lun's blogs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/java/base/Exception.html" class="nav-link">
  异常
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Generics.html" class="nav-link">
  泛型
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Enum.html" class="nav-link">
  枚举
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Serialize.html" class="nav-link">
  Java序列化机制详解
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Proxy.html" class="nav-link">
  动态代理
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Annotation.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  深入理解Java注解
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Stream1.html" class="nav-link">
  Stream源码分析(上)
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Stream2.html" class="nav-link">
  Stream源码分析(下)
</a></li></ul></div></div><div class="nav-item"><a href="/blog/java多线程/" class="nav-link">
  Java多线程
</a></div><div class="nav-item"><a href="/blog/jvm/" class="nav-link">
  JVM
</a></div><div class="nav-item"><a href="/blog/redis/" class="nav-link">
  Redis
</a></div><div class="nav-item"><a href="/blog/blogs/" class="nav-link">
  随笔
</a></div><div class="nav-item"><a href="https://juejin.cn/user/2159878519134157" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/java/base/Exception.html" class="nav-link">
  异常
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Generics.html" class="nav-link">
  泛型
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Enum.html" class="nav-link">
  枚举
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Serialize.html" class="nav-link">
  Java序列化机制详解
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Proxy.html" class="nav-link">
  动态代理
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Annotation.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  深入理解Java注解
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Stream1.html" class="nav-link">
  Stream源码分析(上)
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Stream2.html" class="nav-link">
  Stream源码分析(下)
</a></li></ul></div></div><div class="nav-item"><a href="/blog/java多线程/" class="nav-link">
  Java多线程
</a></div><div class="nav-item"><a href="/blog/jvm/" class="nav-link">
  JVM
</a></div><div class="nav-item"><a href="/blog/redis/" class="nav-link">
  Redis
</a></div><div class="nav-item"><a href="/blog/blogs/" class="nav-link">
  随笔
</a></div><div class="nav-item"><a href="https://juejin.cn/user/2159878519134157" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Java基础知识</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/java/base/Exception.html" class="sidebar-link">Java异常实现原理</a></li><li><a href="/blog/java/base/Generics.html" class="sidebar-link">泛型</a></li><li><a href="/blog/java/base/Enum.html" class="sidebar-link">枚举</a></li><li><a href="/blog/java/base/Serialize.html" class="sidebar-link">Java序列化机制详解</a></li><li><a href="/blog/java/base/Proxy.html" class="sidebar-link">两种动态代理</a></li><li><a href="/blog/java/base/Annotation.html" aria-current="page" class="active sidebar-link">注解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/java/base/Annotation.html#java注解快速开始" class="sidebar-link">Java注解快速开始</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/java/base/Annotation.html#元注解" class="sidebar-link">元注解</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Annotation.html#target-注解的目标" class="sidebar-link" style="padding-left:3rem;">@target：注解的目标</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Annotation.html#retention-注解的生命周期" class="sidebar-link" style="padding-left:3rem;">@Retention：注解的生命周期</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Annotation.html#注解是如何生效的" class="sidebar-link">注解是如何生效的</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Annotation.html#对于编译期注解" class="sidebar-link" style="padding-left:3rem;">对于编译期注解</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Annotation.html#对于运行时注解" class="sidebar-link" style="padding-left:3rem;">对于运行时注解</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Annotation.html#运行期具体如何获取注解" class="sidebar-link">运行期具体如何获取注解</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Annotation.html#判断是否包含注解" class="sidebar-link" style="padding-left:3rem;">判断是否包含注解</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Annotation.html#获取指定类型的注解" class="sidebar-link" style="padding-left:3rem;">获取指定类型的注解</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Annotation.html#获取所有注解" class="sidebar-link" style="padding-left:3rem;">获取所有注解</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/java/base/Annotation.html#实战-自定义运行时注解" class="sidebar-link">实战：自定义运行时注解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/java/base/Annotation.html#_1、定义注解" class="sidebar-link">1、定义注解</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Annotation.html#_2、使用注解" class="sidebar-link">2、使用注解</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Annotation.html#_3、获取并使用注解" class="sidebar-link">3、获取并使用注解</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Annotation.html#运行时注解存放在哪里" class="sidebar-link" style="padding-left:3rem;">运行时注解存放在哪里</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/java/base/Annotation.html#运行时注解的实现原理" class="sidebar-link">运行时注解的实现原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/java/base/Annotation.html#注解接口实例化-代理" class="sidebar-link">注解接口实例化：代理</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Annotation.html#jdk动态代理-annotationinvocationhandler" class="sidebar-link">JDK动态代理：AnnotationInvocationHandler</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Annotation.html#元数据的本质" class="sidebar-link" style="padding-left:3rem;">元数据的本质</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Annotation.html#运行时注解原理小结" class="sidebar-link">运行时注解原理小结</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Annotation.html#编译期注解的实现原理" class="sidebar-link">编译期注解的实现原理</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Annotation.html#参考文档" class="sidebar-link">参考文档</a></li></ul></li></ul></li><li><a href="/blog/java/base/Stream1.html" class="sidebar-link">Stream 源码解析（上）</a></li><li><a href="/blog/java/base/Stream2.html" class="sidebar-link">Stream 源码解析（下）</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="注解"><a href="#注解" class="header-anchor">#</a> 注解</h1> <h3 id="注解的重要性"><a href="#注解的重要性" class="header-anchor">#</a> 注解的重要性</h3> <p>如今，主流的Spring开发大都是全注解开发。</p> <p>自定义注解的应用十分广泛，比如：使用Spring AOP，用来做日志切面打印处理</p> <p>因此，学会元注解，自定义注解，了解注解实现原理是Java程序员的必修课</p> <h3 id="注解是什么"><a href="#注解是什么" class="header-anchor">#</a> 注解是什么</h3> <p>从功能上来说，注解是「元数据」。<strong>注解可以在某处提供额外的信息，便于之后使用这些信息</strong>。</p> <p>从根本上来说，注解只是个特殊的接口。</p> <h2 id="java注解快速开始"><a href="#java注解快速开始" class="header-anchor">#</a> Java注解快速开始</h2> <p><code>@Override</code> 可能是最常见的Java注解之一，表示方法是被覆写的，如果不是覆写的就会在编译时就报错，我们就以此为例来快速认识注解。</p> <p><code>@Override</code> 的源码很短，如下：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 注解可以修饰什么目标 比如方法,类等</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">METHOD</span><span class="token punctuation">)</span>
<span class="token comment">// 注解的生命周期 , 注解在它所修饰的目标中可以被保留到何时</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">SOURCE</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Override</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="元注解"><a href="#元注解" class="header-anchor">#</a> 元注解</h3> <p>元注解：是Java提供的基础注解</p> <h4 id="target-注解的目标"><a href="#target-注解的目标" class="header-anchor">#</a> @target：注解的目标</h4> <p>@target表示注解可以修饰什么目标，<code>ElementType.METHOD</code>：允许该注解作用在方法上</p> <p>常见的取值还有，<code>ElementType.FIELD</code>：允许作用在属性字段上</p> <blockquote><p>注：@target的取值可以用{}多选</p></blockquote> <p>你可以在 ElementType 中找到所有的取值，在此就不一一列举了。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">ElementType</span> <span class="token punctuation">{</span>
    <span class="token comment">/** Class, interface (including annotation type), or enum declaration */</span>
    <span class="token constant">TYPE</span><span class="token punctuation">,</span>
    <span class="token comment">// ...</span>
    <span class="token comment">/** Annotation type declaration */</span>
    <span class="token constant">ANNOTATION_TYPE</span><span class="token punctuation">,</span>

    <span class="token comment">/** Package declaration */</span>
    <span class="token constant">PACKAGE</span><span class="token punctuation">,</span>

    <span class="token comment">/**
     * Type parameter declaration
     *
     * @since 1.8
     */</span>
    <span class="token constant">TYPE_PARAMETER</span><span class="token punctuation">,</span>
     <span class="token comment">/**
     * Use of a type
     *
     * @since 1.8
     */</span>
    <span class="token constant">TYPE_USE</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h4 id="retention-注解的生命周期"><a href="#retention-注解的生命周期" class="header-anchor">#</a> @Retention：注解的生命周期</h4> <p>@Retention表示注解的生命周期 ，即注解在它所修饰的目标中可以被保留到何时，取值如下：</p> <ul><li><code>RetentionPolicy.SOURCE</code>：当前注解编译期可见，不会写入 class 文件</li> <li><code>RetentionPolicy.CLASS</code>：类加载阶段丢弃，在class文件的属性表中用 <strong>RuntimeInvisibleAnnotations</strong>表示</li> <li><code>RetentionPolicy.RUNTIME</code>：<strong>永久保存，可以反射获取，一般自定义注解都是RUNTIME</strong>，在class文件的属性表中用<strong>RuntimeVisibleAnnotations</strong> 表示</li></ul> <p>至此，我们已经知道了 <code>@Override</code> 源码中两个注解的含义，但是 <code>@Override</code> 究竟是如何生效的？</p> <h3 id="注解是如何生效的"><a href="#注解是如何生效的" class="header-anchor">#</a> 注解是如何生效的</h3> <p>实际上，注解可以根据生命周期分为两类，编译期注解 和 运行时注解。</p> <p>Spring框架提供的大部分注解都属于运行时注解，通过运行时反射处理，而Lombok则大量提供编译期注解。</p> <h4 id="对于编译期注解"><a href="#对于编译期注解" class="header-anchor">#</a> 对于编译期注解</h4> <p>对于编译期注解，编译器扫描处理，比如对于<code>@Override</code>修饰的方法，编译器会检查父类是否有相同的方法</p> <h4 id="对于运行时注解"><a href="#对于运行时注解" class="header-anchor">#</a> 对于运行时注解</h4> <p>一般通过运行期反射处理。</p> <h3 id="运行期具体如何获取注解"><a href="#运行期具体如何获取注解" class="header-anchor">#</a> 运行期具体如何获取注解</h3> <p>反射获取注解的核心在： java.lang.reflect下的 <strong>AnnotatedElement</strong>接口，而<strong>AnnotatedElement</strong> 接口是所有程序元素（Class、Method和Constructor）的父接口。</p> <p>对于一个类或者接口来说，Class 类中提供了以下一些方法用于反射操作注解。</p> <h4 id="判断是否包含注解"><a href="#判断是否包含注解" class="header-anchor">#</a> 判断是否包含注解</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">boolean</span> <span class="token function">isAnnotationPresent</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token keyword">extends</span> <span class="token class-name">Annotation</span><span class="token punctuation">&gt;</span></span> annotationClass<span class="token punctuation">)</span>
<span class="token comment">// 此方法会忽略注解对应的注解容器</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="获取指定类型的注解"><a href="#获取指定类型的注解" class="header-anchor">#</a> 获取指定类型的注解</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Annotation</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">getAnnotation</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> annotationClass<span class="token punctuation">)</span> 
     <span class="token comment">// xxx name = getAnnotation(xxx.class);</span>
     <span class="token comment">// 若不存在 返回null</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>如果该注解「可重复」，即同type的注解有多个：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Annotation</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getAnnotationsByType</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> annotationClass<span class="token punctuation">)</span> 
	<span class="token comment">//若不存在 返回长度为0的数组</span>
    <span class="token comment">// 可重复的元注解是@Repeatable</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>忽略「继承」的注解的版本 + Declared</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Annotation</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">getDeclaredAnnotation</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> annotationClass<span class="token punctuation">)</span> 
<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Annotation</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getDeclaredAnnotationsByType</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> annotationClass<span class="token punctuation">)</span> 
    <span class="token comment">// 一个父类的被@Inherited 修饰的注解，子类也会有</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="获取所有注解"><a href="#获取所有注解" class="header-anchor">#</a> 获取所有注解</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Annotation</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getAnnotations</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token comment">// 若没有注解  返回长度为0的数组</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>同样有个Declared的版本忽略继承的注解</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Annotation</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getDeclaredAnnotations</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="实战-自定义运行时注解"><a href="#实战-自定义运行时注解" class="header-anchor">#</a> 实战：自定义运行时注解</h2> <h3 id="_1、定义注解"><a href="#_1、定义注解" class="header-anchor">#</a> 1、定义注解</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code>  <span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">METHOD</span><span class="token punctuation">)</span>
  <span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
 <span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">TestAnnotation</span> <span class="token punctuation">{</span>
     <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">title</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
     <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">description</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_2、使用注解"><a href="#_2、使用注解" class="header-anchor">#</a> 2、使用注解</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@TestAnnotation</span><span class="token punctuation">(</span>title <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span> description <span class="token operator">=</span> <span class="token string">&quot;xxx&quot;</span><span class="token punctuation">)</span>
     <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">xxx</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_3、获取并使用注解"><a href="#_3、获取并使用注解" class="header-anchor">#</a> 3、获取并使用注解</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token comment">// 获取所有methods</span>
          <span class="token class-name">Method</span><span class="token punctuation">[</span><span class="token punctuation">]</span> methods <span class="token operator">=</span> <span class="token class-name">TestAnnotation</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                  <span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;com.lun.annotation.TestAnnotation&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                  <span class="token punctuation">.</span><span class="token function">getMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// 遍历</span>
         <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Method</span> method <span class="token operator">:</span> methods<span class="token punctuation">)</span> <span class="token punctuation">{</span>
             <span class="token comment">// 找注解</span>
             <span class="token keyword">if</span> <span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">isAnnotationPresent</span><span class="token punctuation">(</span><span class="token class-name">TestAnnotation</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token class-name">TestAnnotation</span> test <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">getAnnotation</span><span class="token punctuation">(</span><span class="token class-name">MyMethodAnnotation</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 				  <span class="token comment">// 访问注解的属性</span>
                  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>test<span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="运行时注解存放在哪里"><a href="#运行时注解存放在哪里" class="header-anchor">#</a> 运行时注解存放在哪里</h4> <p>在class文件中的attributes中。详见**『JVM - 类文件结构 - 属性表集合』**</p> <h2 id="运行时注解的实现原理"><a href="#运行时注解的实现原理" class="header-anchor">#</a> 运行时注解的实现原理</h2> <p>注解的本质就是一个继承了 Annotation 接口的接口，因此也会被编译成class文件。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Override</span> <span class="token keyword">extends</span> <span class="token class-name">Annotation</span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>并且注解内部的“数据”，本质是一个接口方法。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">title</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>但我们是可以通过反射拿到Annotation实例的，那么：</p> <ul><li><strong>Annotation明明是个接口，怎么实例化的？</strong></li> <li><strong>方法也是抽象方法，它的执行逻辑去哪里了？</strong></li></ul> <p>实际上，<strong>我们在运行期获取到的注解，都是代理类。</strong></p> <h3 id="注解接口实例化-代理"><a href="#注解接口实例化-代理" class="header-anchor">#</a> 注解接口实例化：代理</h3> <p>来看获取注解的源码：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">A</span> <span class="token keyword">extends</span> <span class="token class-name">Annotation</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">A</span> <span class="token function">getAnnotation</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">A</span><span class="token punctuation">&gt;</span></span> annotationClass<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">A</span><span class="token punctuation">)</span> <span class="token function">annotationData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>annotations<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>annotationClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>最终调用到</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Annotation</span> <span class="token function">annotationForMap</span><span class="token punctuation">(</span>
    <span class="token keyword">final</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Annotation</span><span class="token punctuation">&gt;</span></span> var0<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> var1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Annotation</span><span class="token punctuation">)</span><span class="token class-name">AccessController</span><span class="token punctuation">.</span><span class="token function">doPrivileged</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PrivilegedAction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Annotation</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token class-name">Annotation</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 这不是 老朋友 JDK动态代理 吗</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Annotation</span><span class="token punctuation">)</span><span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>
                var0<span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
               <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>var0<span class="token punctuation">}</span><span class="token punctuation">,</span> 
                <span class="token keyword">new</span> <span class="token class-name">AnnotationInvocationHandler</span><span class="token punctuation">(</span>var0<span class="token punctuation">,</span> var1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><blockquote><p>如果对 JDK动态代理 不熟悉请先参考：</p></blockquote> <h3 id="jdk动态代理-annotationinvocationhandler"><a href="#jdk动态代理-annotationinvocationhandler" class="header-anchor">#</a> JDK动态代理：AnnotationInvocationHandler</h3> <p>核心属性：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Annotation</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">;</span>
<span class="token comment">// 一张哈希表</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> memberValues<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">transient</span> <span class="token keyword">volatile</span> <span class="token class-name">Method</span><span class="token punctuation">[</span><span class="token punctuation">]</span> memberMethods <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>注意上面调用的构造函数：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">AnnotationInvocationHandler</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Annotation</span><span class="token punctuation">&gt;</span></span> var1<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> var2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> var1<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>memberValues <span class="token operator">=</span> var2<span class="token punctuation">;</span>
<span class="token punctuation">}</span>   <span class="token comment">// 省略注解类的判断</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="元数据的本质"><a href="#元数据的本质" class="header-anchor">#</a> 元数据的本质</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> var1<span class="token punctuation">,</span> <span class="token class-name">Method</span> var2<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> var3<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 方法名</span>
    <span class="token class-name">String</span> var4 <span class="token operator">=</span> var2<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 此处省略 一些不需要代理的方法比如equals，hashcode，toString 以及参数校验</span>
    <span class="token comment">// 像annotationType方法，也是不代理 直接返回注解的type</span>
 	<span class="token keyword">if</span> <span class="token punctuation">(</span>var4<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;annotationType&quot;</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>type<span class="token punctuation">;</span>
    <span class="token comment">// 这里是正常的代理逻辑：</span>
        <span class="token comment">// 可以看到 对于接口的方法 转化为了对memberValues的get操作</span>
            <span class="token class-name">Object</span> var6 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>memberValues<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>var4<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>异常<span class="token punctuation">)</span><span class="token punctuation">{</span>抛出<span class="token punctuation">}</span> 
        	<span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// 如果是数组的话 会拷贝一份 对拿到的数组的修改 不会影响到注解本身的值</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>var6<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name">Array</span><span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span>var6<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    var6 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cloneArray</span><span class="token punctuation">(</span>var6<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> var6<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="运行时注解原理小结"><a href="#运行时注解原理小结" class="header-anchor">#</a> 运行时注解原理小结</h3> <p>注解本质是个接口，无法实例化，所以我们在运行期反射拿到的注解，其实是Proxy代理，本质是JDK动态代理。核心的代理类是<strong>AnnotationInvocationHandler</strong>。这个类内部用一张Map存储注解的k - v，用一个Class描述注解的类型。对注解内数据的获取，因为注解是个接口，方法都是抽象方法，实际仅仅是对内部的map的get调用。当然此处会屏蔽一些比如toString，equals等不需要代理的方法。</p> <p>再往JVM底层说，注解也被存储在class文件的属性表，包括了注解的全类名，以及若干pair键值对，保存注解的参数和具体值。</p> <h3 id="编译期注解的实现原理"><a href="#编译期注解的实现原理" class="header-anchor">#</a> 编译期注解的实现原理</h3> <p>JDK5首次提出注解，仅仅面向运行期注解，在JDK6才提出了编译期注解，提供了「插入式注解处理器」的API，这会影响前端编译器的工作。</p> <p>在Javac源码中，插入式注解处理器的初始化过程是在 <code>initPorcessAnnotations()</code> 方法中完成的，而它的执行过程则是在 <code>processAnnotations()</code> 方法中完成。这个方法会判断是否还有新的注解处理器需要执行，如果有的话，通过 <code>com.sun.tools.javac.processing.JavacProcessing-Environment</code> 类的 <code>doProcessing()</code> 方法来生成一个新的 <code>JavaCompiler</code> 对象，对编译的后续步骤进行处理。</p> <p>《周志明》P510：插入式注解处理器实战 值得一看</p> <p><a href="https://www.race604.com/annotation-processing/" target="_blank" rel="noopener noreferrer">Java注解处理器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>这篇文章详细分析了编译期注解的原理，很推荐</p> <h3 id="参考文档"><a href="#参考文档" class="header-anchor">#</a> 参考文档</h3> <p><a href="https://www.pdai.tech/md/java/basic/java-basic-x-annotation.html" target="_blank" rel="noopener noreferrer">Java 基础 - 注解机制详解<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://blog.csdn.net/m0_37235955/article/details/115678621?spm=1001.2014.3001.5501" target="_blank" rel="noopener noreferrer">Java 注解机制<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://blog.csdn.net/qq_20009015/article/details/106038023" target="_blank" rel="noopener noreferrer">java注解的本质以及注解的底层实现原理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/java/base/Proxy.html" class="prev">
        两种动态代理
      </a></span> <span class="next"><a href="/blog/java/base/Stream1.html">
        Stream 源码解析（上）
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.7b9df32b.js" defer></script><script src="/blog/assets/js/2.be714ec7.js" defer></script><script src="/blog/assets/js/1.26c7c9cc.js" defer></script><script src="/blog/assets/js/50.c900e52a.js" defer></script>
  </body>
</html>
