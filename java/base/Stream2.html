<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Stream æºç è§£æï¼ˆä¸‹ï¼‰ | lun&#39;s blogs</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/blog/favicon.ico">
    <meta name="description" content="blog">
    
    <link rel="preload" href="/blog/assets/css/0.styles.56f5eb6c.css" as="style"><link rel="preload" href="/blog/assets/js/app.7b9df32b.js" as="script"><link rel="preload" href="/blog/assets/js/2.be714ec7.js" as="script"><link rel="preload" href="/blog/assets/js/1.26c7c9cc.js" as="script"><link rel="preload" href="/blog/assets/js/56.ace3e6e3.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.0d71bf2e.js"><link rel="prefetch" href="/blog/assets/js/11.cc81c248.js"><link rel="prefetch" href="/blog/assets/js/12.5e69cd14.js"><link rel="prefetch" href="/blog/assets/js/13.f0bc7bf2.js"><link rel="prefetch" href="/blog/assets/js/14.0188e855.js"><link rel="prefetch" href="/blog/assets/js/15.48a1e71e.js"><link rel="prefetch" href="/blog/assets/js/16.0f4182c9.js"><link rel="prefetch" href="/blog/assets/js/17.ec7b8f9d.js"><link rel="prefetch" href="/blog/assets/js/18.776522e2.js"><link rel="prefetch" href="/blog/assets/js/19.26561e06.js"><link rel="prefetch" href="/blog/assets/js/20.3e42feda.js"><link rel="prefetch" href="/blog/assets/js/21.fd4e7a00.js"><link rel="prefetch" href="/blog/assets/js/22.b59f6079.js"><link rel="prefetch" href="/blog/assets/js/23.e6b2d3ec.js"><link rel="prefetch" href="/blog/assets/js/24.736cfa99.js"><link rel="prefetch" href="/blog/assets/js/25.91176041.js"><link rel="prefetch" href="/blog/assets/js/26.146e299c.js"><link rel="prefetch" href="/blog/assets/js/27.56a57551.js"><link rel="prefetch" href="/blog/assets/js/28.13a846a1.js"><link rel="prefetch" href="/blog/assets/js/29.f71b59d6.js"><link rel="prefetch" href="/blog/assets/js/3.f34ea2f7.js"><link rel="prefetch" href="/blog/assets/js/30.bf0626f9.js"><link rel="prefetch" href="/blog/assets/js/31.47592684.js"><link rel="prefetch" href="/blog/assets/js/32.63f20fc3.js"><link rel="prefetch" href="/blog/assets/js/33.4852d9ec.js"><link rel="prefetch" href="/blog/assets/js/34.4f467138.js"><link rel="prefetch" href="/blog/assets/js/35.17d26444.js"><link rel="prefetch" href="/blog/assets/js/36.d0059312.js"><link rel="prefetch" href="/blog/assets/js/37.fc856e5d.js"><link rel="prefetch" href="/blog/assets/js/38.dc6b373c.js"><link rel="prefetch" href="/blog/assets/js/39.f04e5b6a.js"><link rel="prefetch" href="/blog/assets/js/4.885368ff.js"><link rel="prefetch" href="/blog/assets/js/40.b378efa5.js"><link rel="prefetch" href="/blog/assets/js/41.3c800d8a.js"><link rel="prefetch" href="/blog/assets/js/42.8b804f0c.js"><link rel="prefetch" href="/blog/assets/js/43.832aa078.js"><link rel="prefetch" href="/blog/assets/js/44.d1121c11.js"><link rel="prefetch" href="/blog/assets/js/45.b3e8ede1.js"><link rel="prefetch" href="/blog/assets/js/46.01e4202b.js"><link rel="prefetch" href="/blog/assets/js/47.489850e9.js"><link rel="prefetch" href="/blog/assets/js/48.3bd88d5f.js"><link rel="prefetch" href="/blog/assets/js/49.08c6f759.js"><link rel="prefetch" href="/blog/assets/js/5.d1dbc0b1.js"><link rel="prefetch" href="/blog/assets/js/50.c900e52a.js"><link rel="prefetch" href="/blog/assets/js/51.a59d8fbf.js"><link rel="prefetch" href="/blog/assets/js/52.0c715d23.js"><link rel="prefetch" href="/blog/assets/js/53.07715a2f.js"><link rel="prefetch" href="/blog/assets/js/54.e0d8cc69.js"><link rel="prefetch" href="/blog/assets/js/55.1efa3b0b.js"><link rel="prefetch" href="/blog/assets/js/57.221667c1.js"><link rel="prefetch" href="/blog/assets/js/58.a786e5bd.js"><link rel="prefetch" href="/blog/assets/js/59.8a6dde26.js"><link rel="prefetch" href="/blog/assets/js/6.7ee6eed6.js"><link rel="prefetch" href="/blog/assets/js/60.0192f277.js"><link rel="prefetch" href="/blog/assets/js/61.75813485.js"><link rel="prefetch" href="/blog/assets/js/62.d8de1a01.js"><link rel="prefetch" href="/blog/assets/js/63.a08485a4.js"><link rel="prefetch" href="/blog/assets/js/64.7d19f572.js"><link rel="prefetch" href="/blog/assets/js/65.3f290d9a.js"><link rel="prefetch" href="/blog/assets/js/66.73f49082.js"><link rel="prefetch" href="/blog/assets/js/67.cb22e678.js"><link rel="prefetch" href="/blog/assets/js/68.22dc7228.js"><link rel="prefetch" href="/blog/assets/js/69.1f450482.js"><link rel="prefetch" href="/blog/assets/js/7.153b9c62.js"><link rel="prefetch" href="/blog/assets/js/70.03205c0b.js"><link rel="prefetch" href="/blog/assets/js/71.5b98edf5.js"><link rel="prefetch" href="/blog/assets/js/72.8be00756.js"><link rel="prefetch" href="/blog/assets/js/73.5e60394c.js"><link rel="prefetch" href="/blog/assets/js/74.a1100b64.js"><link rel="prefetch" href="/blog/assets/js/75.b47153bc.js"><link rel="prefetch" href="/blog/assets/js/76.b881f0b9.js"><link rel="prefetch" href="/blog/assets/js/77.eef60dd8.js"><link rel="prefetch" href="/blog/assets/js/78.b52fa32f.js"><link rel="prefetch" href="/blog/assets/js/79.9adc486f.js"><link rel="prefetch" href="/blog/assets/js/80.10b21516.js"><link rel="prefetch" href="/blog/assets/js/81.12c11cbc.js"><link rel="prefetch" href="/blog/assets/js/82.df4ae15b.js"><link rel="prefetch" href="/blog/assets/js/83.078b9ed6.js"><link rel="prefetch" href="/blog/assets/js/84.2d8ccb46.js"><link rel="prefetch" href="/blog/assets/js/85.4d5e44f4.js"><link rel="prefetch" href="/blog/assets/js/86.c32dda95.js"><link rel="prefetch" href="/blog/assets/js/87.c28d1f54.js"><link rel="prefetch" href="/blog/assets/js/88.c06457bb.js"><link rel="prefetch" href="/blog/assets/js/89.1febc082.js"><link rel="prefetch" href="/blog/assets/js/90.37985dbe.js"><link rel="prefetch" href="/blog/assets/js/91.9c3ebd93.js"><link rel="prefetch" href="/blog/assets/js/vendors~docsearch.02634ae8.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.56f5eb6c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/logo.png" alt="lun's blogs" class="logo"> <span class="site-name can-hide">lun's blogs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/java/base/Exception.html" class="nav-link">
  å¼‚å¸¸
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Generics.html" class="nav-link">
  æ³›å‹
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Enum.html" class="nav-link">
  æšä¸¾
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Serialize.html" class="nav-link">
  Javaåºåˆ—åŒ–æœºåˆ¶è¯¦è§£
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Proxy.html" class="nav-link">
  åŠ¨æ€ä»£ç†
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Annotation.html" class="nav-link">
  æ·±å…¥ç†è§£Javaæ³¨è§£
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Stream1.html" class="nav-link">
  Streamæºç åˆ†æ(ä¸Š)
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Stream2.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Streamæºç åˆ†æ(ä¸‹)
</a></li></ul></div></div><div class="nav-item"><a href="/blog/javaå¤šçº¿ç¨‹/" class="nav-link">
  Javaå¤šçº¿ç¨‹
</a></div><div class="nav-item"><a href="/blog/jvm/" class="nav-link">
  JVM
</a></div><div class="nav-item"><a href="/blog/redis/" class="nav-link">
  Redis
</a></div><div class="nav-item"><a href="/blog/blogs/" class="nav-link">
  éšç¬”
</a></div><div class="nav-item"><a href="https://juejin.cn/user/2159878519134157" target="_blank" rel="noopener noreferrer" class="nav-link external">
  åšå®¢
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/java/base/Exception.html" class="nav-link">
  å¼‚å¸¸
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Generics.html" class="nav-link">
  æ³›å‹
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Enum.html" class="nav-link">
  æšä¸¾
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Serialize.html" class="nav-link">
  Javaåºåˆ—åŒ–æœºåˆ¶è¯¦è§£
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Proxy.html" class="nav-link">
  åŠ¨æ€ä»£ç†
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Annotation.html" class="nav-link">
  æ·±å…¥ç†è§£Javaæ³¨è§£
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Stream1.html" class="nav-link">
  Streamæºç åˆ†æ(ä¸Š)
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Stream2.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Streamæºç åˆ†æ(ä¸‹)
</a></li></ul></div></div><div class="nav-item"><a href="/blog/javaå¤šçº¿ç¨‹/" class="nav-link">
  Javaå¤šçº¿ç¨‹
</a></div><div class="nav-item"><a href="/blog/jvm/" class="nav-link">
  JVM
</a></div><div class="nav-item"><a href="/blog/redis/" class="nav-link">
  Redis
</a></div><div class="nav-item"><a href="/blog/blogs/" class="nav-link">
  éšç¬”
</a></div><div class="nav-item"><a href="https://juejin.cn/user/2159878519134157" target="_blank" rel="noopener noreferrer" class="nav-link external">
  åšå®¢
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JavaåŸºç¡€çŸ¥è¯†</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/java/base/Exception.html" class="sidebar-link">Javaå¼‚å¸¸å®ç°åŸç†</a></li><li><a href="/blog/java/base/Generics.html" class="sidebar-link">æ³›å‹</a></li><li><a href="/blog/java/base/Enum.html" class="sidebar-link">æšä¸¾</a></li><li><a href="/blog/java/base/Serialize.html" class="sidebar-link">Javaåºåˆ—åŒ–æœºåˆ¶è¯¦è§£</a></li><li><a href="/blog/java/base/Proxy.html" class="sidebar-link">ä¸¤ç§åŠ¨æ€ä»£ç†</a></li><li><a href="/blog/java/base/Annotation.html" class="sidebar-link">æ³¨è§£</a></li><li><a href="/blog/java/base/Stream1.html" class="sidebar-link">Stream æºç è§£æï¼ˆä¸Šï¼‰</a></li><li><a href="/blog/java/base/Stream2.html" aria-current="page" class="active sidebar-link">Stream æºç è§£æï¼ˆä¸‹ï¼‰</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#streamçš„ç»ˆæ­¢" class="sidebar-link">Streamçš„ç»ˆæ­¢</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#ç»ˆæ­¢æ“ä½œçš„åˆ†ç±»ä¸å…±æ€§" class="sidebar-link">ç»ˆæ­¢æ“ä½œçš„åˆ†ç±»ä¸å…±æ€§</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#çŸ­è·¯æ“ä½œ-å¯ä»¥æå‰ç»ˆæ­¢çš„æ“ä½œ" class="sidebar-link">çŸ­è·¯æ“ä½œï¼šå¯ä»¥æå‰ç»ˆæ­¢çš„æ“ä½œ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#åŒ¹é…æ“ä½œ-matchop" class="sidebar-link">åŒ¹é…æ“ä½œï¼šMatchOp</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#anymatch" class="sidebar-link" style="padding-left:3rem;">anyMatch</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#allmatch" class="sidebar-link" style="padding-left:3rem;">allMatch</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#æŸ¥æ‰¾æ“ä½œ-findop" class="sidebar-link">æŸ¥æ‰¾æ“ä½œï¼šFindOp</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#findfirst-è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ " class="sidebar-link" style="padding-left:3rem;">findFirstï¼šè¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ </a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#éçŸ­è·¯æ“ä½œ-æ— æ³•æå‰ç»ˆæ­¢" class="sidebar-link">éçŸ­è·¯æ“ä½œï¼šæ— æ³•æå‰ç»ˆæ­¢</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#éå†-foreachop" class="sidebar-link">éå†ï¼šForEachOp</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#foreeah" class="sidebar-link" style="padding-left:3rem;">forEeah</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#èšåˆ-reduceop" class="sidebar-link">èšåˆï¼šReduceOp</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#reduce-èšåˆ" class="sidebar-link" style="padding-left:3rem;">reduceï¼šèšåˆ</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#max-min-æ±‚æœ€å¤§æœ€å°å…ƒç´ " class="sidebar-link" style="padding-left:3rem;">max/minï¼šæ±‚æœ€å¤§æœ€å°å…ƒç´ </a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#collect-å°†æµè½¬åŒ–ä¸ºé›†åˆ" class="sidebar-link" style="padding-left:3rem;">collectï¼šå°†æµè½¬åŒ–ä¸ºé›†åˆ</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#ç»ˆæ­¢æ“ä½œçš„æµç¨‹ğŸš©" class="sidebar-link">ç»ˆæ­¢æ“ä½œçš„æµç¨‹ğŸš©</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#_1ã€terminalop-ç»ˆæ­¢æ“ä½œ" class="sidebar-link">1ã€TerminalOpï¼šç»ˆæ­¢æ“ä½œ</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#_2ã€evaluate-æ‰§è¡Œæ“ä½œ" class="sidebar-link">2ã€evaluate()ï¼šæ‰§è¡Œæ“ä½œ</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#å››å¤§terminalopæ¶æ„-å…±åŒç‚¹" class="sidebar-link">å››å¤§TerminalOpæ¶æ„/å…±åŒç‚¹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#foreachop" class="sidebar-link">ForEachOp</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#reduceop" class="sidebar-link">ReduceOp</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#findop" class="sidebar-link">FindOp</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#matchop" class="sidebar-link">MatchOp</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#wrapandcopyintoæ–¹æ³•" class="sidebar-link">wrapAndCopyIntoæ–¹æ³•</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#_1ã€å°è£…sink" class="sidebar-link">1ã€å°è£…Sink</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#_2ã€æ‰§è¡Œcopyinto-éå†å¤„ç†" class="sidebar-link">2ã€æ‰§è¡ŒcopyIntoï¼šéå†å¤„ç†</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#_2-1ã€è‹¥çŸ­è·¯æ“ä½œ" class="sidebar-link" style="padding-left:3rem;">2.1ã€è‹¥çŸ­è·¯æ“ä½œ</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#_2-2ã€è‹¥éçŸ­è·¯æ“ä½œ" class="sidebar-link" style="padding-left:3rem;">2.2ã€è‹¥éçŸ­è·¯æ“ä½œ</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#å°ç»“" class="sidebar-link">å°ç»“</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#ä¸­é—´æ“ä½œæ˜¯å¦‚ä½•ç”Ÿæ•ˆçš„" class="sidebar-link">ä¸­é—´æ“ä½œæ˜¯å¦‚ä½•ç”Ÿæ•ˆçš„</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#collectæ–¹æ³•çš„å‚æ•°-collector" class="sidebar-link">collectæ–¹æ³•çš„å‚æ•°ï¼šCollector</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#collectoræ¥å£" class="sidebar-link" style="padding-left:3rem;">Collectoræ¥å£</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#collectorå”¯ä¸€å®ç°-collectorimpl" class="sidebar-link" style="padding-left:3rem;">Collectorå”¯ä¸€å®ç°ï¼šCollectorImpl</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#collectorså·¥å…·ç±»" class="sidebar-link">Collectorså·¥å…·ç±»</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#tolist-è¿”å›arraylist" class="sidebar-link" style="padding-left:3rem;">toList()ï¼šè¿”å›ArrayList</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#tolistçš„terminalop" class="sidebar-link" style="padding-left:4rem;">toListçš„terminalOp</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#joining-å­—ç¬¦ä¸²æ‹¼æ¥" class="sidebar-link" style="padding-left:3rem;">joining()ï¼šå­—ç¬¦ä¸²æ‹¼æ¥</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#toset-è¿”å›hashset" class="sidebar-link" style="padding-left:3rem;">toSet()ï¼šè¿”å›HashSet</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#tomap-è¿”å›hashmap" class="sidebar-link" style="padding-left:3rem;">toMap()ï¼šè¿”å›HashMap</a></li><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#ç‰¹æ®Šçš„ç»ˆæ­¢-toarray" class="sidebar-link">ç‰¹æ®Šçš„ç»ˆæ­¢ï¼štoArray</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#å°ç»“-streamè¯­å¥çš„åŸç†" class="sidebar-link">å°ç»“ï¼šStreamè¯­å¥çš„åŸç†</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/java/base/Stream2.html#å‚è€ƒæ–‡æ¡£" class="sidebar-link" style="padding-left:3rem;">å‚è€ƒæ–‡æ¡£</a></li></ul></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="stream-æºç è§£æ-ä¸‹"><a href="#stream-æºç è§£æ-ä¸‹" class="header-anchor">#</a> Stream æºç è§£æï¼ˆä¸‹ï¼‰</h1> <p>ä¸Šæ–‡æˆ‘ä»¬ä»‹ç»äº†æµçš„åˆ›å»ºå’Œä¸­é—´æ“ä½œï¼Œä¸‹é¢è®²ä¸€è®²Streamçš„ç»ˆæ­¢æ“ä½œ</p> <h2 id="streamçš„ç»ˆæ­¢"><a href="#streamçš„ç»ˆæ­¢" class="header-anchor">#</a> Streamçš„ç»ˆæ­¢</h2> <h3 id="ç»ˆæ­¢æ“ä½œçš„åˆ†ç±»ä¸å…±æ€§"><a href="#ç»ˆæ­¢æ“ä½œçš„åˆ†ç±»ä¸å…±æ€§" class="header-anchor">#</a> ç»ˆæ­¢æ“ä½œçš„åˆ†ç±»ä¸å…±æ€§</h3> <p>ç»ˆæ­¢æ“ä½œåˆåˆ†ä¸ºã€ŒçŸ­è·¯æ“ä½œã€å’Œã€ŒéçŸ­è·¯æ“ä½œã€ã€‚</p> <p>ä¹‹ååˆæ ¹æ®ä¸åŒä½œç”¨åˆ†ç±»ã€‚</p> <p>ä¸‹é¢åˆ—å‡ºä¸€äº›å¸¸ç”¨APIï¼Œè¯»è€…å¯ä»¥å°è¯•è§‚å¯Ÿå®ƒä»¬çš„å…±åŒç‚¹å’Œä¸åŒç‚¹ã€‚</p> <h2 id="çŸ­è·¯æ“ä½œ-å¯ä»¥æå‰ç»ˆæ­¢çš„æ“ä½œ"><a href="#çŸ­è·¯æ“ä½œ-å¯ä»¥æå‰ç»ˆæ­¢çš„æ“ä½œ" class="header-anchor">#</a> çŸ­è·¯æ“ä½œï¼šå¯ä»¥æå‰ç»ˆæ­¢çš„æ“ä½œ</h2> <p>å¦‚æœæ˜¯çŸ­è·¯æ“ä½œï¼Œé‚£ä¹ˆä¸ä¸€å®šéœ€è¦å®Œæ•´çš„éå†æ•´ä¸ªStreamçš„å…ƒç´ ï¼Œåœ¨æŸäº›æ¡ä»¶ä¸‹ï¼Œå¯ä»¥æå‰å¾—åˆ°ç»“æœï¼Œæå‰ç»“æŸéå†è¿‡ç¨‹ã€‚çŸ­è·¯æ“ä½œæœ‰<strong>MatchOpå’ŒFindOp</strong>ä¸¤ä¸ªTerminalOpå®ç°ï¼Œåˆ†åˆ«è¡¨ç¤ºåŒ¹é…å’ŒæŸ¥æ‰¾ã€‚</p> <blockquote><p>cancellationRequested()ï¼šå¦‚æœè¿”å›trueï¼Œè¡¨ç¤ºsinkä¸å†å¤„ç†Streamä¸­åç»­çš„å…ƒç´ ï¼Œç”¨äºçŸ­è·¯æ“ä½œã€‚</p></blockquote> <h3 id="åŒ¹é…æ“ä½œ-matchop"><a href="#åŒ¹é…æ“ä½œ-matchop" class="header-anchor">#</a> åŒ¹é…æ“ä½œï¼šMatchOp</h3> <h4 id="anymatch"><a href="#anymatch" class="header-anchor">#</a> anyMatch</h4> <p>æœ‰ä¸€ä¸ªåŒ¹é…å°±ç«‹åˆ»è¿”å›true</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">anyMatch</span><span class="token punctuation">(</span><span class="token class-name">Predicate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> P_OUT<span class="token punctuation">&gt;</span></span> predicate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token class-name">MatchOps</span><span class="token punctuation">.</span><span class="token function">makeRef</span><span class="token punctuation">(</span>predicate<span class="token punctuation">,</span> <span class="token class-name">MatchOps<span class="token punctuation">.</span>MatchKind</span><span class="token punctuation">.</span><span class="token constant">ANY</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="allmatch"><a href="#allmatch" class="header-anchor">#</a> allMatch</h4> <p>æœ‰ä¸€ä¸ªä¸åŒ¹é…å°±ç«‹åˆ»è¿”å›false</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">allMatch</span><span class="token punctuation">(</span><span class="token class-name">Predicate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> P_OUT<span class="token punctuation">&gt;</span></span> predicate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token class-name">MatchOps</span><span class="token punctuation">.</span><span class="token function">makeRef</span><span class="token punctuation">(</span>predicate<span class="token punctuation">,</span> <span class="token class-name">MatchOps<span class="token punctuation">.</span>MatchKind</span><span class="token punctuation">.</span><span class="token constant">ALL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="æŸ¥æ‰¾æ“ä½œ-findop"><a href="#æŸ¥æ‰¾æ“ä½œ-findop" class="header-anchor">#</a> æŸ¥æ‰¾æ“ä½œï¼šFindOp</h3> <h4 id="findfirst-è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ "><a href="#findfirst-è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ " class="header-anchor">#</a> findFirstï¼šè¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ </h4> <p>è™½ç„¶åå­—å«findä½†findAnyåœ¨å¹¶è¡Œæµå°±æ˜¯éšä¾¿è¿”å›é›†åˆå†…ä¸€ä¸ªå…ƒç´ ï¼Œåœ¨ä¸²è¡Œæµï¼Œå°±æ˜¯è¿”å›é›†åˆçš„é¦–å…ƒç´ ï¼ŒæŒºæ²¡ç”¨çš„ï¼Œä¸æ”¯æŒè‡ªå®šä¹‰è¿‡æ»¤ã€‚è¦è‡ªå·±åŒ¹é…è¿˜å¾—ç”¨matchã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span>P_OUT<span class="token punctuation">&gt;</span></span> <span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token class-name">FindOps</span><span class="token punctuation">.</span><span class="token function">makeRef</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>findAnyåœ¨ä¸²è¡Œæµä¸findFirstå®Œå…¨ç›¸åŒï¼Œå¦‚æœæ˜¯å¹¶è¡Œæµï¼Œä¸ä¸€å®šæ˜¯ç¬¬ä¸€ä¸ªã€‚</p> <h2 id="éçŸ­è·¯æ“ä½œ-æ— æ³•æå‰ç»ˆæ­¢"><a href="#éçŸ­è·¯æ“ä½œ-æ— æ³•æå‰ç»ˆæ­¢" class="header-anchor">#</a> éçŸ­è·¯æ“ä½œï¼šæ— æ³•æå‰ç»ˆæ­¢</h2> <h3 id="éå†-foreachop"><a href="#éå†-foreachop" class="header-anchor">#</a> éå†ï¼šForEachOp</h3> <h4 id="foreeah"><a href="#foreeah" class="header-anchor">#</a> forEeah</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> P_OUT<span class="token punctuation">&gt;</span></span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token class-name">ForEachOps</span><span class="token punctuation">.</span><span class="token function">makeRef</span><span class="token punctuation">(</span>action<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>forEachOrdered</strong>ï¼šåœ¨ä¸²è¡Œæµä¸­ï¼Œä¸forEeahçš„ç»“æœæ²¡åŒºåˆ«ã€‚è¿™ä¸ªæ˜¯ä¸ºäº†ä¿è¯<strong>å¹¶è¡Œæµå¯¹å…ƒç´ çš„å¤„ç†é¡ºåºæ˜¯ä»å‰å¾€å</strong></p> <h3 id="èšåˆ-reduceop"><a href="#èšåˆ-reduceop" class="header-anchor">#</a> èšåˆï¼šReduceOp</h3> <h4 id="reduce-èšåˆ"><a href="#reduce-èšåˆ" class="header-anchor">#</a> reduceï¼šèšåˆ</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span>P_OUT<span class="token punctuation">&gt;</span></span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">BinaryOperator</span><span class="token generics"><span class="token punctuation">&lt;</span>P_OUT<span class="token punctuation">&gt;</span></span> accumulator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token class-name">ReduceOps</span><span class="token punctuation">.</span><span class="token function">makeRef</span><span class="token punctuation">(</span>accumulator<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="max-min-æ±‚æœ€å¤§æœ€å°å…ƒç´ "><a href="#max-min-æ±‚æœ€å¤§æœ€å°å…ƒç´ " class="header-anchor">#</a> max/minï¼šæ±‚æœ€å¤§æœ€å°å…ƒç´ </h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span>P_OUT<span class="token punctuation">&gt;</span></span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> P_OUT<span class="token punctuation">&gt;</span></span> comparator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token class-name">BinaryOperator</span><span class="token punctuation">.</span><span class="token function">maxBy</span><span class="token punctuation">(</span>comparator<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ä¹Ÿå°±æ˜¯max/minå®é™…è°ƒç”¨çš„æ˜¯ä¸Šé¢è¿™ä¸ªreduceæ–¹æ³•</p> <h4 id="collect-å°†æµè½¬åŒ–ä¸ºé›†åˆ"><a href="#collect-å°†æµè½¬åŒ–ä¸ºé›†åˆ" class="header-anchor">#</a> collectï¼šå°†æµè½¬åŒ–ä¸ºé›†åˆ</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">R</span><span class="token punctuation">,</span> <span class="token class-name">A</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">R</span> <span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> P_OUT<span class="token punctuation">,</span> <span class="token class-name">A</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">&gt;</span></span> collector<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">A</span> container<span class="token punctuation">;</span>
    <span class="token comment">// å»æ‰äº†å¹¶è¡Œæµçš„åˆ¤æ–­å¤„ç†</span>
        container <span class="token operator">=</span> <span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token class-name">ReduceOps</span><span class="token punctuation">.</span><span class="token function">makeRef</span><span class="token punctuation">(</span>collector<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> collector<span class="token punctuation">.</span><span class="token function">characteristics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token class-name">Collector<span class="token punctuation">.</span>Characteristics</span><span class="token punctuation">.</span><span class="token constant">IDENTITY_FINISH</span><span class="token punctuation">)</span>
           <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">)</span> container
           <span class="token operator">:</span> collector<span class="token punctuation">.</span><span class="token function">finisher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="ç»ˆæ­¢æ“ä½œçš„æµç¨‹ğŸš©"><a href="#ç»ˆæ­¢æ“ä½œçš„æµç¨‹ğŸš©" class="header-anchor">#</a> ç»ˆæ­¢æ“ä½œçš„æµç¨‹ğŸš©</h2> <ol><li>æ‰€æœ‰æ–¹æ³•éƒ½æ ¹æ®ä½œç”¨åˆ†ç±»æˆäº†ä¸åŒçš„Opï¼Œå®ƒä»¬çš„çˆ¶ç±»éƒ½æ˜¯TerminalOpã€‚è°ƒç”¨äº†å¯¹åº”çš„xxxOpså·¥å‚ç±»çš„makeRefæ–¹æ³•å¾—åˆ°ä¸€ä¸ªTerminalOpçš„å®ç°ç±»ã€‚</li> <li>æ‰§è¡Œevaluateæ–¹æ³•ã€‚</li></ol> <p>ç®€å•è¯´ï¼Œå°±æ˜¯åˆ©ç”¨å·¥å‚ç±»ï¼Œæ ¹æ®ä½ çš„ç‰¹ç‚¹ï¼Œ<strong>ç”Ÿæˆä¸€ä¸ªç»ˆæ­¢æ“ä½œï¼šTerminalOpï¼Œç„¶åevaluate</strong>ã€‚</p> <h3 id="_1ã€terminalop-ç»ˆæ­¢æ“ä½œ"><a href="#_1ã€terminalop-ç»ˆæ­¢æ“ä½œ" class="header-anchor">#</a> 1ã€TerminalOpï¼šç»ˆæ­¢æ“ä½œ</h3> <p>è¿™é‡Œæ’ä¸€å˜´ï¼ŒTerminalOpä¸åƒå‰é¢éƒ½ç»§æ‰¿è‡ªpipelineã€‚TerminalOpè‡ªå·±å°±æ˜¯ä¸ª<strong>é¡¶å±‚çš„çˆ¶æ¥å£</strong>ã€‚</p> <p>å¹¶ä¸”<strong>TerminalOpå¹¶ä¸ä¼šåƒå…¶ä»–ä¸­é—´æ“ä½œä¸€æ ·ä»è¿”å›ä¸€ä¸ªStream</strong>ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">interface</span> <span class="token class-name">TerminalOp</span><span class="token generics"><span class="token punctuation">&lt;</span>E_IN<span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    
    <span class="token keyword">default</span> <span class="token class-name">StreamShape</span> <span class="token function">inputShape</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token class-name">StreamShape</span><span class="token punctuation">.</span><span class="token constant">REFERENCE</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">default</span> <span class="token keyword">int</span> <span class="token function">getOpFlags</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token comment">// å¹¶è¡Œ evaluate</span>
    <span class="token keyword">default</span> <span class="token generics"><span class="token punctuation">&lt;</span>P_IN<span class="token punctuation">&gt;</span></span> <span class="token class-name">R</span> <span class="token function">evaluateParallel</span><span class="token punctuation">(</span><span class="token class-name">PipelineHelper</span><span class="token generics"><span class="token punctuation">&lt;</span>E_IN<span class="token punctuation">&gt;</span></span> helper<span class="token punctuation">,</span>
                                      <span class="token class-name">Spliterator</span><span class="token generics"><span class="token punctuation">&lt;</span>P_IN<span class="token punctuation">&gt;</span></span> spliterator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ç®€ç•¥äº†ä¸€ä¸‹</span>
        <span class="token keyword">return</span> <span class="token function">evaluateSequential</span><span class="token punctuation">(</span>helper<span class="token punctuation">,</span> spliterator<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ä¸²è¡Œ evaluate æŠ½è±¡æ–¹æ³•</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>P_IN<span class="token punctuation">&gt;</span></span> <span class="token class-name">R</span> <span class="token function">evaluateSequential</span><span class="token punctuation">(</span><span class="token class-name">PipelineHelper</span><span class="token generics"><span class="token punctuation">&lt;</span>E_IN<span class="token punctuation">&gt;</span></span> helper<span class="token punctuation">,</span>
                                <span class="token class-name">Spliterator</span><span class="token generics"><span class="token punctuation">&lt;</span>P_IN<span class="token punctuation">&gt;</span></span> spliterator<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="_2ã€evaluate-æ‰§è¡Œæ“ä½œ"><a href="#_2ã€evaluate-æ‰§è¡Œæ“ä½œ" class="header-anchor">#</a> 2ã€evaluate()ï¼šæ‰§è¡Œæ“ä½œ</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">final</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">R</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">R</span> <span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token class-name">TerminalOp</span><span class="token generics"><span class="token punctuation">&lt;</span>E_OUT<span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">&gt;</span></span> terminalOp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// å¿½ç•¥æ ¡éªŒ</span>
    <span class="token keyword">return</span> <span class="token function">isParallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
           <span class="token operator">?</span>  <span class="token comment">// å¹¶è¡Œ</span>
 terminalOp<span class="token punctuation">.</span><span class="token function">evaluateParallel</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token function">sourceSpliterator</span><span class="token punctuation">(</span>terminalOp<span class="token punctuation">.</span><span class="token function">getOpFlags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
           <span class="token operator">:</span>  <span class="token comment">// ä¸²è¡Œ             </span>
 terminalOp<span class="token punctuation">.</span><span class="token function">evaluateSequential</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token function">sourceSpliterator</span><span class="token punctuation">(</span>terminalOp<span class="token punctuation">.</span><span class="token function">getOpFlags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>ä¹Ÿå°±æ˜¯çœŸæ­£çš„æ‰§è¡Œæ˜¯terminalOp.evaluateSequentialæ–¹æ³•ï¼Œæ˜¯å†™åœ¨terminalOpå†…éƒ¨çš„</p> <p>é‚£ä¹ˆæ ¸å¿ƒç‚¹å°±åœ¨äºterminalOpäº†ã€‚</p> <h2 id="å››å¤§terminalopæ¶æ„-å…±åŒç‚¹"><a href="#å››å¤§terminalopæ¶æ„-å…±åŒç‚¹" class="header-anchor">#</a> å››å¤§TerminalOpæ¶æ„/å…±åŒç‚¹</h2> <ul><li>éƒ½æ˜¯<strong>å·¥å‚æ¨¡å¼</strong>ï¼Œç”±xxxOps.makeRefæ–¹æ³•åˆ›å»ºå¯¹è±¡ã€‚</li> <li>éƒ½<strong>é‡å†™äº†evaluateXXX</strong>æ–¹æ³•ï¼Œå³ä¸€ä¸ªStreamæµè¯­å¥çš„æœ€ç»ˆæ‰§è¡Œ</li> <li>éƒ½å®ç°äº†TerminalOpæ¥å£</li> <li>evaluateXXXæ–¹æ³•<strong>æœ€ç»ˆéƒ½æ˜¯è°ƒç”¨pipelineçš„wrapAndCopyIntoæ–¹æ³•</strong></li></ul> <h3 id="foreachop"><a href="#foreachop" class="header-anchor">#</a> ForEachOp</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">ForEachOp</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span>
        <span class="token keyword">implements</span> <span class="token class-name">TerminalOp</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">TerminalSink</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> ordered<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>TerminalOpæ¥å£</strong>ï¼šå‰æ–‡ä»‹ç»è¿‡ï¼Œä¸»è¦æ˜¯æä¾›äº†evaluateæ–¹æ³•çš„å…·ä½“å®ç°</p> <p><strong>TerminalSinkæ¥å£</strong>ï¼šç»§æ‰¿äº†Sinkå’ŒSupplierï¼ŒSinkç»§æ‰¿è‡ªConsumerï¼Œæœ‰æ¶ˆè´¹èƒ½åŠ›çš„åŒæ—¶æä¾›äº†begin/endã€‚Supplierä¹Ÿæ˜¯lambdaè¡¨è¾¾å¼ï¼Œæ— å‚æœ‰è¿”å›å€¼ã€‚</p> <p>é‡ç‚¹æ˜¯é‡å†™äº†evaluateæ–¹æ³•</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// å› ä¸ºforeachæ²¡æœ‰è¿”å›å€¼ï¼Œæ‰€ä»¥getè¿”å›null thiså°±æ˜¯å½“å‰çš„TerminalOp</span>
<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Void</span> <span class="token function">evaluateSequential</span><span class="token punctuation">(</span><span class="token class-name">PipelineHelper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> helper<span class="token punctuation">,</span>
                                   <span class="token class-name">Spliterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> spliterator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> helper<span class="token punctuation">.</span><span class="token function">wrapAndCopyInto</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> spliterator<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="reduceop"><a href="#reduceop" class="header-anchor">#</a> ReduceOp</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">ReduceOp</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">,</span> <span class="token class-name">S</span> <span class="token keyword">extends</span> <span class="token class-name">AccumulatingSink</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">,</span> <span class="token class-name">S</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span>
        <span class="token keyword">implements</span> <span class="token class-name">TerminalOp</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token comment">// makeSinkæ–¹æ³•æŠ½è±¡</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">S</span> <span class="token function">makeSink</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ä¸å…³æ³¨å¹¶è¡Œäº†ã€‚å®ç°äº†evaluateSequentialæ–¹æ³•</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span>P_IN<span class="token punctuation">&gt;</span></span> <span class="token class-name">R</span> <span class="token function">evaluateSequential</span><span class="token punctuation">(</span><span class="token class-name">PipelineHelper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> helper<span class="token punctuation">,</span>
                                       <span class="token class-name">Spliterator</span><span class="token generics"><span class="token punctuation">&lt;</span>P_IN<span class="token punctuation">&gt;</span></span> spliterator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> helper<span class="token punctuation">.</span><span class="token function">wrapAndCopyInto</span><span class="token punctuation">(</span><span class="token function">makeSink</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> spliterator<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="findop"><a href="#findop" class="header-anchor">#</a> FindOp</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">FindOp</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">O</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">TerminalOp</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">O</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token comment">// æ ¸å¿ƒå±æ€§</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">StreamShape</span> shape<span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">boolean</span> mustFindFirst<span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">O</span> emptyValue<span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">Predicate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">O</span><span class="token punctuation">&gt;</span></span> presentPredicate<span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TerminalSink</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">O</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> sinkSupplier<span class="token punctuation">;</span>
    <span class="token comment">// æ–¹æ³•</span>
   <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">O</span> <span class="token function">evaluateSequential</span><span class="token punctuation">(</span><span class="token class-name">PipelineHelper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> helper<span class="token punctuation">,</span><span class="token class-name">Spliterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> spliterator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">O</span> result <span class="token operator">=</span> helper<span class="token punctuation">.</span><span class="token function">wrapAndCopyInto</span><span class="token punctuation">(</span>sinkSupplier<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> spliterator<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> result <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> result <span class="token operator">:</span> emptyValue<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>    
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>å¯ä»¥çœ‹åˆ°ä¹Ÿæ˜¯wrapAndCopyIntoæ–¹æ³•ã€‚</p> <h3 id="matchop"><a href="#matchop" class="header-anchor">#</a> MatchOp</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">MatchOp</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">TerminalOp</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">StreamShape</span> inputShape<span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">MatchKind</span> matchKind<span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BooleanTerminalSink</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> sinkSupplier<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Boolean</span> <span class="token function">evaluateSequential</span><span class="token punctuation">(</span><span class="token class-name">PipelineHelper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> helper<span class="token punctuation">,</span>
                                              <span class="token class-name">Spliterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> spliterator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> helper<span class="token punctuation">.</span><span class="token function">wrapAndCopyInto</span><span class="token punctuation">(</span>sinkSupplier<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> spliterator<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAndClearState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="wrapandcopyintoæ–¹æ³•"><a href="#wrapandcopyintoæ–¹æ³•" class="header-anchor">#</a> wrapAndCopyIntoæ–¹æ³•</h2> <p><strong>å››å¤§Opçš„evaluateSequentialæ–¹æ³•éƒ½è°ƒç”¨äº†pipelineçš„wrapAndCopyIntoæ–¹æ³•ã€‚</strong></p> <p>æ­£å¦‚æ–¹æ³•åï¼š</p> <ol><li>wrapåŒ…è£…sink</li> <li>æ‰§è¡ŒCopyIntoæ–¹æ³•</li></ol> <p>wrapAndCopyIntoæ–¹æ³•çš„å®ç°åœ¨AbstractPipeline</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">final</span> <span class="token generics"><span class="token punctuation">&lt;</span>P_IN<span class="token punctuation">,</span> <span class="token class-name">S</span> <span class="token keyword">extends</span> <span class="token class-name">Sink</span><span class="token punctuation">&lt;</span>E_OUT<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">S</span> <span class="token function">wrapAndCopyInto</span><span class="token punctuation">(</span><span class="token class-name">S</span> sink<span class="token punctuation">,</span> <span class="token class-name">Spliterator</span><span class="token generics"><span class="token punctuation">&lt;</span>P_IN<span class="token punctuation">&gt;</span></span> spliterator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">copyInto</span><span class="token punctuation">(</span><span class="token function">wrapSink</span><span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">requireNonNull</span><span class="token punctuation">(</span>sink<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> spliterator<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> sink<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_1ã€å°è£…sink"><a href="#_1ã€å°è£…sink" class="header-anchor">#</a> 1ã€å°è£…Sink</h3> <p>è¿™é‡Œé¦–å…ˆæœ‰ä¸€ä¸ªwrapSinkæ–¹æ³•ï¼Œå¯¹sinkçš„å°è£…</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">final</span> <span class="token generics"><span class="token punctuation">&lt;</span>P_IN<span class="token punctuation">&gt;</span></span> <span class="token class-name">Sink</span><span class="token generics"><span class="token punctuation">&lt;</span>P_IN<span class="token punctuation">&gt;</span></span> <span class="token function">wrapSink</span><span class="token punctuation">(</span><span class="token class-name">Sink</span><span class="token generics"><span class="token punctuation">&lt;</span>E_OUT<span class="token punctuation">&gt;</span></span> sink<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token class-name">AbstractPipeline</span> p<span class="token operator">=</span><span class="token class-name">AbstractPipeline</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">;</span> p<span class="token punctuation">.</span>depth <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span> p<span class="token operator">=</span>p<span class="token punctuation">.</span>previousStage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        sink <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">opWrapSink</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>previousStage<span class="token punctuation">.</span>combinedFlags<span class="token punctuation">,</span> sink<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Sink</span><span class="token generics"><span class="token punctuation">&lt;</span>P_IN<span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> sink<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œ<strong>å¾€å›éå†åŒå‘é“¾è¡¨ç„¶åè°ƒç”¨opWrapSinkæ–¹æ³•ï¼Œä»ç„¶è¿”å›ä¸€ä¸ªsink</strong>ã€‚</p> <p>opWrapSinkæ–¹æ³•è¿˜è®°å¾—å—ï¼Ÿæ˜¯æ‰€æœ‰ä¸ç®¡æœ‰æ— çŠ¶æ€çš„Opå³<strong>ä¸­é—´æ“ä½œå¿…é¡»é‡å†™çš„æ–¹æ³•</strong>ã€‚</p> <p>è¿™é‡Œå›é¡¾ä¸€ä¸‹mapçš„ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Override</span>
    <span class="token class-name">Sink</span><span class="token generics"><span class="token punctuation">&lt;</span>P_OUT<span class="token punctuation">&gt;</span></span> <span class="token function">opWrapSink</span><span class="token punctuation">(</span><span class="token keyword">int</span> flags<span class="token punctuation">,</span> <span class="token class-name">Sink</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">R</span><span class="token punctuation">&gt;</span></span> sink<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment">// è¿”å› Sink.ChainedReference</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Sink<span class="token punctuation">.</span>ChainedReference</span><span class="token generics"><span class="token punctuation">&lt;</span>P_OUT<span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>sink<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">P_OUT</span> u<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// è¿™ä¸ªmapperå°±æ˜¯ map(mapper) lambdaè¡¨è¾¾å¼ï¼Œæ¯”å¦‚ æ˜ å°„åˆ°Idå°±æ˜¯ User::getId</span>
                downstream<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>mapper<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>ChainedReferenceæœ‰ä¸€ä¸ªæ ¸å¿ƒå±æ€§ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token class-name">Sink</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> E_OUT<span class="token punctuation">&gt;</span></span> downstream<span class="token punctuation">;</span>
<span class="token comment">// å³ä¸‹ä¸€ä¸ªçš„Sinkï¼Œä»è€Œå®ç°Sinkçš„ç›¸è¿</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>åˆé‡å†™äº†acceptæ–¹æ³•ï¼Œå³å½“å‰Opå…ˆapplyç»“æŸä»¥åï¼Œå†è°ƒç”¨ä¸‹ä¸€ä¸ªçš„Opï¼Œä»è€Œå®ç°äº†æ‰€æœ‰Opçš„ç›¸è¿ï¼Œè¿”å›äº†ä¸€ä¸ªæœ€ç»ˆçš„Sinkã€‚</p> <p>è‡³æ­¤ç¡®å®šäº†copyIntoçš„wrappedSinkå‚æ•°ã€‚</p> <h3 id="_2ã€æ‰§è¡Œcopyinto-éå†å¤„ç†"><a href="#_2ã€æ‰§è¡Œcopyinto-éå†å¤„ç†" class="header-anchor">#</a> 2ã€æ‰§è¡ŒcopyIntoï¼šéå†å¤„ç†</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// wrapAndCopyInto è°ƒç”¨ copyInto</span>
    <span class="token keyword">final</span> <span class="token generics"><span class="token punctuation">&lt;</span>P_IN<span class="token punctuation">&gt;</span></span> <span class="token keyword">void</span> <span class="token function">copyInto</span><span class="token punctuation">(</span><span class="token class-name">Sink</span><span class="token generics"><span class="token punctuation">&lt;</span>P_IN<span class="token punctuation">&gt;</span></span> wrappedSink<span class="token punctuation">,</span> <span class="token class-name">Spliterator</span><span class="token generics"><span class="token punctuation">&lt;</span>P_IN<span class="token punctuation">&gt;</span></span> spliterator<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StreamOpFlag</span><span class="token punctuation">.</span><span class="token constant">SHORT_CIRCUIT</span><span class="token punctuation">.</span><span class="token function">isKnown</span><span class="token punctuation">(</span><span class="token function">getStreamAndOpFlags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            wrappedSink<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span>spliterator<span class="token punctuation">.</span><span class="token function">getExactSizeIfKnown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            spliterator<span class="token punctuation">.</span><span class="token function">forEachRemaining</span><span class="token punctuation">(</span>wrappedSink<span class="token punctuation">)</span><span class="token punctuation">;</span>
            wrappedSink<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">copyIntoWithCancel</span><span class="token punctuation">(</span>wrappedSink<span class="token punctuation">,</span> spliterator<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>SHORT_CIRCUITæ˜¯çŸ­è·¯çš„æ„æ€ï¼Œå› æ­¤å¦‚æœæ˜¯çŸ­è·¯æ“ä½œï¼Œè¿›å…¥ copyIntoWithCancelï¼›å¦åˆ™forEachRemaining</p> <h4 id="_2-1ã€è‹¥çŸ­è·¯æ“ä½œ"><a href="#_2-1ã€è‹¥çŸ­è·¯æ“ä½œ" class="header-anchor">#</a> 2.1ã€è‹¥çŸ­è·¯æ“ä½œ</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">final</span> <span class="token generics"><span class="token punctuation">&lt;</span>P_IN<span class="token punctuation">&gt;</span></span> <span class="token keyword">void</span> <span class="token function">copyIntoWithCancel</span><span class="token punctuation">(</span><span class="token class-name">Sink</span><span class="token generics"><span class="token punctuation">&lt;</span>P_IN<span class="token punctuation">&gt;</span></span> wrappedSink<span class="token punctuation">,</span> <span class="token class-name">Spliterator</span><span class="token generics"><span class="token punctuation">&lt;</span>P_IN<span class="token punctuation">&gt;</span></span> spliterator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// é“¾è¡¨å°¾</span>
    <span class="token class-name">AbstractPipeline</span> p <span class="token operator">=</span> <span class="token class-name">AbstractPipeline</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>depth <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        p <span class="token operator">=</span> p<span class="token punctuation">.</span>previousStage<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    wrappedSink<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span>spliterator<span class="token punctuation">.</span><span class="token function">getExactSizeIfKnown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ä¾æ¬¡æ¶ˆè´¹æ‰€æœ‰å…ƒç´ </span>
    p<span class="token punctuation">.</span><span class="token function">forEachWithCancel</span><span class="token punctuation">(</span>spliterator<span class="token punctuation">,</span> wrappedSink<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    wrappedSink<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

    <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">forEachWithCancel</span><span class="token punctuation">(</span><span class="token class-name">Spliterator</span><span class="token generics"><span class="token punctuation">&lt;</span>P_OUT<span class="token punctuation">&gt;</span></span> spliterator<span class="token punctuation">,</span> <span class="token class-name">Sink</span><span class="token generics"><span class="token punctuation">&lt;</span>P_OUT<span class="token punctuation">&gt;</span></span> sink<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">do</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>sink<span class="token punctuation">.</span><span class="token function">cancellationRequested</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> spliterator<span class="token punctuation">.</span><span class="token function">tryAdvance</span><span class="token punctuation">(</span>sink<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token comment">// tryAdvanceå°±æ˜¯ï¼Œç”¨lambdaè¡¨è¾¾å¼çš„acceptæ–¹æ³•æ¶ˆè´¹ä¸€ä¸ªå…ƒç´ ï¼Œsinkå°±æ˜¯consumerçš„å­ç±»ï¼Œæœ‰acceptæ–¹æ³•</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="_2-2ã€è‹¥éçŸ­è·¯æ“ä½œ"><a href="#_2-2ã€è‹¥éçŸ­è·¯æ“ä½œ" class="header-anchor">#</a> 2.2ã€è‹¥éçŸ­è·¯æ“ä½œ</h4> <p>éçŸ­è·¯æ“ä½œï¼š</p> <ul><li><strong>å…ˆbegin</strong></li> <li><strong>åspliterator.forEachRemaining(wrappedSink);</strong></li> <li><strong>æœ€åend</strong></li></ul> <p><strong>beginå’Œendéƒ½è¢«StatexxxOpé‡å†™ï¼Œè€ŒforEachRemainingåˆè¢«å„ç§spliteratoré‡å†™</strong></p> <p>è¿™é‡Œä»¥ArrayListSpliteratorä¸ºä¾‹ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">forEachRemaining</span><span class="token punctuation">(</span><span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> i<span class="token punctuation">,</span> hi<span class="token punctuation">,</span> mc<span class="token punctuation">;</span> <span class="token comment">// hoist accesses and checks from loop</span>
    <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> lst<span class="token punctuation">;</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>lst <span class="token operator">=</span> list<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>a <span class="token operator">=</span> lst<span class="token punctuation">.</span>elementData<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>hi <span class="token operator">=</span> fence<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mc <span class="token operator">=</span> lst<span class="token punctuation">.</span>modCount<span class="token punctuation">;</span>
            hi <span class="token operator">=</span> lst<span class="token punctuation">.</span>size<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
            mc <span class="token operator">=</span> expectedModCount<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">=</span> index<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>index <span class="token operator">=</span> hi<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> a<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> hi<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">E</span> e <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">E</span><span class="token punctuation">)</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                action<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>lst<span class="token punctuation">.</span>modCount <span class="token operator">==</span> mc<span class="token punctuation">)</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentModificationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>å°±æ˜¯éå†å¤„ç†ã€‚</p> <p>åœ¨evaluateSequentialæ–¹æ³•çš„æœ€åï¼Œé€šå¸¸è¿˜æœ‰ä¸€ä¸ªgetæ–¹æ³•ï¼Œç”¨äºè·å–è¿”å›å€¼ã€‚</p> <p>è‡³æ­¤ï¼Œç»ˆæ­¢æ“ä½œåˆ†æå®Œæ¯•ã€‚</p> <h3 id="å°ç»“"><a href="#å°ç»“" class="header-anchor">#</a> å°ç»“</h3> <p>ç»ˆæ­¢æ“ä½œï¼šå¤§æ¦‚æ˜¯åˆ›å»ºä¸€ä¸ªTerminalOpï¼Œç„¶åè°ƒç”¨evaluateæ–¹æ³•å¤„ç†ã€‚evaluateæœ€ç»ˆä¾èµ–wrapAndCopyIntoï¼Œä¼šéå†åŒå‘é“¾è¡¨æ¥å°è£…ä¸€ä¸ªé“¾å¼Sinkï¼Œç„¶åéå†å…ƒç´ è°ƒç”¨lambdaè¡¨è¾¾å¼å³sinkæ¥å¤„ç†ã€‚</p> <h2 id="ä¸­é—´æ“ä½œæ˜¯å¦‚ä½•ç”Ÿæ•ˆçš„"><a href="#ä¸­é—´æ“ä½œæ˜¯å¦‚ä½•ç”Ÿæ•ˆçš„" class="header-anchor">#</a> ä¸­é—´æ“ä½œæ˜¯å¦‚ä½•ç”Ÿæ•ˆçš„</h2> <p>éçŸ­è·¯ä¸‹ï¼šå…ˆbeginæ–¹æ³•ã€‚å†accpetã€‚æœ€åendã€‚</p> <p>ä¸€èˆ¬éƒ½æ˜¯é“¾å¼è°ƒç”¨ï¼Œæˆ‘å¤„ç†å®Œäº†ï¼Œç»™æˆ‘ä¸‹ä¸€ä¸ªå¤„ç†ã€‚ä½†æ˜¯ä¸ä¹ç‰¹æ®Šçš„ï¼Œæ¯”å¦‚sortedï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">begin</span><span class="token punctuation">(</span><span class="token keyword">long</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    list <span class="token operator">=</span> <span class="token punctuation">(</span>size <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> size<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ’åº</span>
    list<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>comparator<span class="token punctuation">)</span><span class="token punctuation">;</span>
    downstream<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// éçŸ­è·¯ å…¨éƒ¨å¤„ç†</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cancellationWasRequested<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>downstream<span class="token operator">::</span><span class="token function">accept</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// çŸ­è·¯ éšæ—¶å¯èƒ½ä¼šbreak</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">T</span> t <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>downstream<span class="token punctuation">.</span><span class="token function">cancellationRequested</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
            downstream<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    downstream<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    list <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">T</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¹¶æ²¡æœ‰å‘ä¸‹ä¼ é€’</span>
    list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>beginï¼Œacceptæ–¹æ³•å¹¶ä¸æ˜¯é“¾å¼è°ƒç”¨ï¼Œç›¸åï¼Œbeginç›´æ¥åœä½äº†newä¸€ä¸ªArrayListï¼Œacceptæ˜¯å¾€è‡ªå·±çš„ArrayListæ·»åŠ å…ƒç´ ã€‚é‚£ä¹ˆæˆ‘ä»¬çŸ¥é“åé¢çš„acceptæ–¹æ³•å°±ä¸ä¼šè¢«è°ƒç”¨åˆ°äº†ï¼Œäºæ˜¯å¼€å§‹endã€‚æ­¤æ—¶åˆä¼šè®©ä¸‹æ¸¸beginï¼Œacceptï¼Œendèµ°ä¸€å¥—ã€‚</p> <h2 id="collectæ–¹æ³•çš„å‚æ•°-collector"><a href="#collectæ–¹æ³•çš„å‚æ•°-collector" class="header-anchor">#</a> collectæ–¹æ³•çš„å‚æ•°ï¼šCollector</h2> <p>collectæ–¹æ³•ä¸åˆ«çš„ç»ˆæ­¢æ“ä½œæœ‰äº›ä¸ä¸€æ ·ã€‚</p> <p>Collectors.toList()è¿”å›ä¸€ä¸ªCollectoræ¥å£ï¼Œè¿™ä¸ªæ–¹æ³•åšäº†äº›ä»€ä¹ˆå‘¢ï¼Ÿ</p> <h4 id="collectoræ¥å£"><a href="#collectoræ¥å£" class="header-anchor">#</a> Collectoræ¥å£</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Collector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">A</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token comment">// å››ä¸ªlambdaæ–¹æ³•</span>
    <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">A</span><span class="token punctuation">&gt;</span></span> <span class="token function">supplier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">BiConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">A</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">accumulator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">BinaryOperator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">A</span><span class="token punctuation">&gt;</span></span> <span class="token function">combiner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">A</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">&gt;</span></span> <span class="token function">finisher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Characteristicsæšä¸¾ç±» ï¼š CONCURRENT / UNORDERED / IDENTITY_FINISH</span>
    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Characteristics</span><span class="token punctuation">&gt;</span></span> <span class="token function">characteristics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="collectorå”¯ä¸€å®ç°-collectorimpl"><a href="#collectorå”¯ä¸€å®ç°-collectorimpl" class="header-anchor">#</a> Collectorå”¯ä¸€å®ç°ï¼šCollectorImpl</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code>  <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">CollectorImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">A</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">Collector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">A</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
      <span class="token comment">// äº”ä¸ªå±æ€§ åˆ†åˆ«å¯¹åº”äº”ä¸ªæ–¹æ³•</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">A</span><span class="token punctuation">&gt;</span></span> supplier<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">BiConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">A</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> accumulator<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">BinaryOperator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">A</span><span class="token punctuation">&gt;</span></span> combiner<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">A</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">&gt;</span></span> finisher<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Characteristics</span><span class="token punctuation">&gt;</span></span> characteristics<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>å®é™…ä¸Šï¼Œè¿™ä¹Ÿæ˜¯Collectorçš„æœ€å¤§çš„ä½œç”¨äº†ã€‚</p> <p>Collector<strong>ä»…ä»…èµ·åˆ°äº†å°è£…æ•°æ®(ä¸€äº›lambdaè¡¨è¾¾å¼)çš„ä½œç”¨</strong>ã€‚</p> <h2 id="collectorså·¥å…·ç±»"><a href="#collectorså·¥å…·ç±»" class="header-anchor">#</a> Collectorså·¥å…·ç±»</h2> <h4 id="tolist-è¿”å›arraylist"><a href="#tolist-è¿”å›arraylist" class="header-anchor">#</a> toList()ï¼šè¿”å›ArrayList</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token class-name">Collector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CollectorImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
                        <span class="token number">1</span>      <span class="token punctuation">(</span><span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> <span class="token class-name">ArrayList</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">,</span>
                        <span class="token number">2</span>       <span class="token class-name">List</span><span class="token operator">::</span><span class="token function">add</span><span class="token punctuation">,</span>
                        <span class="token number">3</span>       <span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span> left<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> left<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        <span class="token number">4</span>       <span class="token constant">CH_ID</span> <span class="token comment">// è¿™ä¸ªå¯ä»¥ä¸ç”¨ç®¡</span>
                              <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// ä¸Šé¢è°ƒç”¨çš„æ˜¯è¿™ä¸ªæ„é€ æ–¹æ³•</span>
<span class="token comment">// 1 Supplier æ— å‚ï¼Œæœ‰è¿”å›å€¼</span>
<span class="token comment">// 2 BiConsumer ä¸¤ä¸ªå‚æ•°ï¼Œæ²¡æœ‰è¿”å›å€¼</span>
<span class="token comment">// 3 BinaryOperator ä¸¤ä¸ªå…¥å‚ï¼Œæœ‰è¿”å›å€¼ï¼Œä¸‰è€…ç±»å‹ç›¸åŒï¼Œåœ¨toListè¿™é‡Œçš„ç±»å‹æ˜¯ArrayList</span>
<span class="token comment">// çŒœæµ‹ï¼šè¿™é‡Œç”¨ BinaryOperator åº”è¯¥æ˜¯ä¸ºäº†è®©å¹¶è¡Œä¹Ÿèƒ½ç”¨å§...</span>
      <span class="token class-name">CollectorImpl</span><span class="token punctuation">(</span><span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">A</span><span class="token punctuation">&gt;</span></span> supplier<span class="token punctuation">,</span>
                      <span class="token class-name">BiConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">A</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> accumulator<span class="token punctuation">,</span>
                      <span class="token class-name">BinaryOperator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">A</span><span class="token punctuation">&gt;</span></span> combiner<span class="token punctuation">,</span>
                      <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Characteristics</span><span class="token punctuation">&gt;</span></span> characteristics<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token comment">// ä¾æ¬¡èµ‹å€¼  finisheræ¯”è¾ƒç‰¹æ®Šä¸€ç‚¹ï¼Œæ˜¯ finisher  =  castingIdentity()</span>
        <span class="token punctuation">}</span>
  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>Collectors.toList()æ–¹æ³•ç”Ÿæˆäº†ä¸€ä¸ªCollectorImplå®ä¾‹ï¼Œå®ç°äº†Collectoræ¥å£ã€‚ä¼ é€’äº†ä¸‰ä¸ªlambdaæ–¹æ³•</p> <ul><li>new ä¸€ä¸ªArrayList</li> <li>å‘ArrayList addå…ƒç´ </li> <li>å‘ArrayList addAllå¦ä¸€ä¸ªArrayList çš„å…ƒç´ </li></ul> <h5 id="tolistçš„terminalop"><a href="#tolistçš„terminalop" class="header-anchor">#</a> toListçš„terminalOp</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">I</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">TerminalOp</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">I</span><span class="token punctuation">&gt;</span></span> <span class="token function">makeRef</span><span class="token punctuation">(</span><span class="token class-name">Collector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">I</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">&gt;</span></span> collector<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// è¿”å›ä¸€ä¸ª TerminalOp</span>
    <span class="token comment">// supplier æ˜¯ ArrayList::new</span>
    <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">I</span><span class="token punctuation">&gt;</span></span> supplier <span class="token operator">=</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">requireNonNull</span><span class="token punctuation">(</span>collector<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">supplier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// accumulator æ˜¯ List::add</span>
    <span class="token class-name">BiConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">I</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> accumulator <span class="token operator">=</span> collector<span class="token punctuation">.</span><span class="token function">accumulator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// combiner æ˜¯ (left, right) -&gt; { left.addAll(right); return left; }</span>
    <span class="token class-name">BinaryOperator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">I</span><span class="token punctuation">&gt;</span></span> combiner <span class="token operator">=</span> collector<span class="token punctuation">.</span><span class="token function">combiner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ---------------------</span>
    <span class="token keyword">class</span> <span class="token class-name">ReducingSink</span> <span class="token keyword">extends</span> <span class="token class-name">Box</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">I</span><span class="token punctuation">&gt;</span></span>
            <span class="token keyword">implements</span> <span class="token class-name">AccumulatingSink</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">I</span><span class="token punctuation">,</span> <span class="token class-name">ReducingSink</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
        <span class="token comment">// å°±æ˜¯newä¸€ä¸ªArrayList</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">begin</span><span class="token punctuation">(</span><span class="token keyword">long</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            state <span class="token operator">=</span> supplier<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// å‘ArrayList addä¸€ä¸ªå…ƒç´ </span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">T</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            accumulator<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// å‘ArrayList add å¦ä¸€ä¸ªArrayListçš„æ‰€æœ‰å…ƒç´ </span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">combine</span><span class="token punctuation">(</span><span class="token class-name">ReducingSink</span> other<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            state <span class="token operator">=</span> combiner<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> other<span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ---------------------    </span>
    <span class="token comment">// ä»¥ä¸Šå¯ä»¥æ¦‚æ‹¬ä¸ºå–å‡ºCollectorImplçš„å‡ ä¸ªé‡è¦çš„è¡¨è¾¾å¼</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ReduceOp</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">I</span><span class="token punctuation">,</span> <span class="token class-name">ReducingSink</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">StreamShape</span><span class="token punctuation">.</span><span class="token constant">REFERENCE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">ReducingSink</span> <span class="token function">makeSink</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ReducingSink</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// çœç•¥ getOpFlags</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>è‡³æ­¤ï¼Œå¾—åˆ°ä¸€ä¸ªReduceOpå®ä¾‹ï¼Œå¹¶é‡å†™äº†makeSinkæ–¹æ³•ã€‚makeSinkç”¨ä½œwrapAndCopyIntoæ–¹æ³•çš„å…¥å‚ã€‚</p> <p>åœ¨evaluateæ—¶ï¼ŒReduceOpä¹Ÿä¼šè¢«å½“æˆå’Œæ™®é€šçš„StatexxxOpä¸€æ ·ï¼Œè¢«è°ƒç”¨beginï¼Œendï¼Œacceptæ–¹æ³•ï¼Œä»–çš„sinkåœ¨æ•´ä¸ªsinkeé“¾æ¡çš„æœ€åã€‚å› æ­¤å®ç°äº†å°†ç»“æœè½¬åŒ–ä¸ºä¸€ä¸ªArrayListã€‚</p> <h4 id="joining-å­—ç¬¦ä¸²æ‹¼æ¥"><a href="#joining-å­—ç¬¦ä¸²æ‹¼æ¥" class="header-anchor">#</a> joining()ï¼šå­—ç¬¦ä¸²æ‹¼æ¥</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">String</span> result <span class="token operator">=</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;java&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;scala&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;go&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;python&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">joining</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// è¾“å‡º ï¼š java,scala,go,python</span>
<span class="token comment">// æ”¯æŒæ— å‚ç›´æ¥æ‹¼æ¥ï¼Œä¹Ÿæ”¯æŒåˆ†éš”ç¬¦</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>é€šè¿‡åˆ†ætoListæˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œ<strong>Collectoråªæ˜¯å°è£…å‡ ä¸ªå‡½æ•°ï¼Œå› æ­¤ä¸åŒæ–¹æ³•åªæ˜¯å‡ ä¸ªlambdaè¡¨è¾¾å¼æ–¹æ³•å’Œåˆ«äººçš„ä¸åŒï¼Œå› æ­¤åæ–‡åªå…³æ³¨è¿™äº›æ–¹æ³•</strong>ã€‚</p> <p>joining()å°±æ˜¯ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Collector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CharSequence</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">joining</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CollectorImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CharSequence</span><span class="token punctuation">,</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
            <span class="token class-name">StringBuilder</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">,</span>  <span class="token comment">// 1</span>
            <span class="token class-name">StringBuilder</span><span class="token operator">::</span><span class="token function">append</span><span class="token punctuation">,</span> <span class="token comment">// 2 </span>
            <span class="token punctuation">(</span>r1<span class="token punctuation">,</span> r2<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span> r1<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>r2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> r1<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">// 3</span>
            <span class="token class-name">StringBuilder</span><span class="token operator">::</span><span class="token function">toString</span><span class="token punctuation">,</span> <span class="token comment">// 4</span>
            <span class="token constant">CH_NOID</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>å¤šå†™äº†ä¸€ä¸ªæ–¹æ³•ï¼šå°†StringBuilderè½¬åŒ–ä¸ºStringï¼Œå¤šæŒ‡å®šäº†finisheræ–¹æ³•ï¼Œè¿™åœ¨ArrayListæ²¡æœ‰ã€‚</p> <h4 id="toset-è¿”å›hashset"><a href="#toset-è¿”å›hashset" class="header-anchor">#</a> toSet()ï¼šè¿”å›HashSet</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span>
<span class="token class-name">Collector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">,</span> <span class="token class-name">Set</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">toSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CollectorImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
                               <span class="token punctuation">(</span><span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Set</span><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> <span class="token class-name">HashSet</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">,</span> 
                               <span class="token class-name">Set</span><span class="token operator">::</span><span class="token function">add</span><span class="token punctuation">,</span>
                               <span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span> left<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> left<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                               <span class="token constant">CH_UNORDERED_ID</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="tomap-è¿”å›hashmap"><a href="#tomap-è¿”å›hashmap" class="header-anchor">#</a> toMap()ï¼šè¿”å›HashMap</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token punctuation">,</span> <span class="token class-name">M</span> <span class="token keyword">extends</span> <span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span>
<span class="token class-name">Collector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">,</span> <span class="token class-name">M</span><span class="token punctuation">&gt;</span></span> <span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">K</span><span class="token punctuation">&gt;</span></span> keyMapper<span class="token punctuation">,</span>
                            <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> valueMapper<span class="token punctuation">,</span>
                            <span class="token class-name">BinaryOperator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> mergeFunction<span class="token punctuation">,</span>
                            <span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">M</span><span class="token punctuation">&gt;</span></span> mapSupplier<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">BiConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">M</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> accumulator
            <span class="token operator">=</span> <span class="token punctuation">(</span>map<span class="token punctuation">,</span> element<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> map<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>keyMapper<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">// å¤„ç†k</span>
                                          valueMapper<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// å¤„ç†v</span>
                                          mergeFunction<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// mergeæ–¹æ³•å¯ä»¥ç®€å•ç†è§£ä¸º add åªä¸è¿‡å¯ä»¥è‡ªå®šä¹‰keyç›¸åŒçš„æƒ…å†µï¼Œå¦‚ä½•å¤„ç†ï¼Œä¸‹é¢å¯ä»¥çœ‹åˆ°æºç </span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CollectorImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>mapSupplier<span class="token punctuation">,</span>  <span class="token comment">// new </span>
                               accumulator<span class="token punctuation">,</span>  <span class="token comment">// merge</span>
                               <span class="token function">mapMerger</span><span class="token punctuation">(</span>mergeFunction<span class="token punctuation">)</span><span class="token punctuation">,</span>
                               <span class="token constant">CH_ID</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>toMap()è¦ç¨å¾®ç‰¹æ®Šä¸€ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°ä»–æœ‰ä¸ªmergeFunctionçš„å‡½æ•°ï¼Œè¿™ä¸ªæ˜¯å¤„ç†ä¸¤ä¸ªkeyä¸€æ¨¡ä¸€æ ·çš„æƒ…å†µçš„ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// mergeæ˜¯mapæ¥å£ä¸‹çš„æ–¹æ³• ä¸»è¦æ˜¯åˆ©ç”¨remappingFunction å†³å®škeyç›¸åŒæ—¶ï¼Œç”¨å“ªä¸ªvalue</span>
<span class="token keyword">default</span> <span class="token class-name">V</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">,</span>
        <span class="token class-name">BiFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">V</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">V</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> remappingFunction<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">V</span> oldValue <span class="token operator">=</span> <span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">V</span> newValue <span class="token operator">=</span> <span class="token punctuation">(</span>oldValue <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> value <span class="token operator">:</span>
               remappingFunction<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>oldValue<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>newValue <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">remove</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> newValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> newValue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>é™¤äº†ä¸Šè¿°è¿™äº›å†…å®¹ï¼ŒCollectorsè¿˜æä¾›äº†max/minByï¼Œreuducingï¼Œaveragingï¼Œsummingç­‰ç­‰æ–¹æ³•ï¼Œå°±ä¸ä¸€ä¸€ä»‹ç»äº†ã€‚</p> <h3 id="ç‰¹æ®Šçš„ç»ˆæ­¢-toarray"><a href="#ç‰¹æ®Šçš„ç»ˆæ­¢-toarray" class="header-anchor">#</a> ç‰¹æ®Šçš„ç»ˆæ­¢ï¼štoArray</h3> <p>è¿™ä¸ªå°±ä¸å…³å¿ƒå®ç°äº†ï¼Œä½†å®ƒå’Œåˆ«äººç¡®å®éƒ½ä¸å¤ªä¸€æ ·ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">toArray</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">A</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">A</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">toArray</span><span class="token punctuation">(</span><span class="token class-name">IntFunction</span><span class="token operator">&lt;</span><span class="token class-name">A</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> generator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">A</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token class-name">Nodes</span><span class="token punctuation">.</span><span class="token function">flatten</span><span class="token punctuation">(</span><span class="token function">evaluateToArrayNode</span><span class="token punctuation">(</span>generator<span class="token punctuation">)</span><span class="token punctuation">,</span> generator<span class="token punctuation">)</span>
                              <span class="token punctuation">.</span><span class="token function">asArray</span><span class="token punctuation">(</span>generator<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="å°ç»“-streamè¯­å¥çš„åŸç†"><a href="#å°ç»“-streamè¯­å¥çš„åŸç†" class="header-anchor">#</a> å°ç»“ï¼šStreamè¯­å¥çš„åŸç†</h2> <p>ç¬¬ä¸€æ­¥ï¼Œè‚¯å®šæ˜¯<strong>åˆ›å»ºStreamæµå¯¹è±¡</strong>ï¼Œä¼—æ‰€å‘¨çŸ¥Streamæ˜¯ä¸ªæ¥å£ã€‚å› æ­¤æˆ‘ä»¬åˆ›å»ºçš„æµçš„å®ä½“ç±»æ˜¯ï¼šPipelineã€‚ç”¨çš„æœ€å¤šçš„æ˜¯ReferencePipelineï¼Œä»–åˆæœ‰ä¸‰ä¸ªå†…éƒ¨ç±»ï¼šHeadå¤´èŠ‚ç‚¹ï¼Œæ— çŠ¶æ€æ“ä½œï¼Œå’Œæœ‰çŠ¶æ€çš„æ“ä½œã€‚è¿™ä¸¤ç§çŠ¶æ€çš„æ“ä½œæˆ‘åˆç†è§£æˆæ™®é€šèŠ‚ç‚¹ã€‚å› ä¸ºå®ƒæ˜¯å·²<strong>åŒå‘é“¾è¡¨çš„å½¢å¼</strong>ç»„ç»‡èµ·æ¥æ‰€æœ‰çš„Optionçš„ï¼Œå¤´èŠ‚ç‚¹æ˜¯ç‰¹æ®Šçš„Headï¼Œå…¶ä½™èŠ‚ç‚¹å°±æ˜¯è¿™ä¸¤ç§Optionã€‚åˆ›å»ºå¯¹è±¡å‘¢åˆä¾èµ–StreamSupport.streamæ–¹æ³•ã€‚è¿™é‡Œåˆæœ‰ä¸‰ç§åˆ›å»ºæµå¯¹è±¡çš„æ–¹æ³•åº•å±‚å…¨éƒ½ä¾èµ–StreamSupportï¼Œä¼šè¿”å›ä¸€ä¸ªHeadå¤´èŠ‚ç‚¹ã€‚</p> <p>ç¬¬äºŒæ­¥ï¼Œå°±æ˜¯å¾ˆå¤š<strong>ä¸­é—´æ“ä½œ</strong>ï¼Œæ¯”å¦‚æˆ‘ä»¬å¸¸ç”¨çš„mapæ˜ å°„ï¼Œç„¶åsortedæ’åºè¿™äº›ã€‚è¿™äº›æ–¹æ³•çš„å®ç°éƒ½åœ¨AbstractPipelineï¼Œæ˜¯ReferencePipelineçš„çˆ¶ç±»ã€‚ä¹Ÿå¹¶ä¸å¤æ‚ï¼Œé€šå¸¸æ˜¯åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°±æ˜¯æ— çŠ¶æ€æ“ä½œï¼Œå’Œæœ‰çŠ¶æ€æ“ä½œä¸­çš„ä¸€ä¸ªï¼Œç„¶åæ’å…¥åˆ°é“¾è¡¨å°¾éƒ¨ã€‚ç„¶åStatelessOpè¿™ä¹Ÿæ˜¯æŠ½è±¡ç±»ï¼Œè™½ç„¶Streamæ˜¯ä¸ªæƒ°æ€§æµï¼Œä½†æˆ‘ä»¬ä¹Ÿè¦å­˜å‚¨ä½ çš„lambdaè¡¨è¾¾å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦é‡å†™opWrapSinkæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å¾ˆé‡è¦ï¼Œä¼šåœ¨ç»ˆæ­¢Streamçš„æ—¶å€™ä½¿ç”¨ã€‚</p> <p>æœ€åä¸€æ­¥ï¼Œä¹Ÿå°±æ˜¯<strong>ç»ˆæ­¢æ“ä½œ</strong>ã€‚ç»ˆæ­¢æ“ä½œåˆæœ‰å¾ˆå¤šç§æ¯”å¦‚collectï¼Œforeachè¿™äº›ã€‚è¿™äº›æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ª<strong>TerminalOp</strong>å¯¹è±¡ã€‚TerminalOpåˆæœ‰å¾ˆå¤šå­ç±»ï¼Œè¿™é‡Œæˆ‘æ‹¿collectä¸¾ä¾‹å§ï¼Œå°±æ˜¯ReduceOpï¼Œåˆ©ç”¨ReduceOpsçš„makeRefæ–¹æ³•åˆ›å»ºå¯¹è±¡ã€‚å¦‚æœæ˜¯collect(Collections.toList())çš„è¯ä»–å°±ä¼šå‘æœ€åè¿™ä¸ªReduceOpå­˜å‚¨ä¸‰ä¸ªlambdaæ–¹æ³•ï¼Œå°±æ˜¯åˆ›å»ºArrayListï¼Œä»¥åŠArrayListçš„addå’ŒaddAllæ–¹æ³•ã€‚ç„¶åè¿™ä¸ªReduceOpè¿˜ä¼šé‡å†™ä¸€ä¸ªæ–¹æ³•å«makeSinkã€‚è¿™ä¸ªSinkæ˜¯ä¸€ä¸ªConsumerçš„å­ç±»ï¼Œå°±ä¹Ÿæ˜¯ä¸€ä¸ªlambdaè¡¨è¾¾å¼ã€‚æœ€åå‘¢æˆ‘ä»¬æ‰§è¡Œevaluateæ–¹æ³•ï¼Œä¼šå…ˆè°ƒç”¨è¿™ä¸ªmakeSinkæ–¹æ³•å–å‡ºTerminalOpçš„Sinkï¼Œç„¶åå¯¹å®ƒåšä¸€ä¸ªå°è£…ï¼Œå°±æ˜¯ç¬¬äºŒæ­¥ä¸­é—´æ“ä½œæåˆ°çš„é‡å†™çš„opWrapSinkæ–¹æ³•ï¼Œæˆ‘ä»¬ä¼šä»åå¾€å‰éå†åŒå‘é“¾è¡¨ï¼Œä¾æ¬¡è°ƒç”¨è¿™ä¸ªopWrapSinkæ–¹æ³•ï¼Œé‚£è¿™ä¸ªæ–¹æ³•çš„é€»è¾‘æ˜¯å–å†³äºä½ çš„Optionçš„ï¼Œæ¯”å¦‚mapæ˜¯è¿”å›ä¸€ä¸ªSink.ChainedReferenceï¼Œé¦–å…ˆå®ƒå†…éƒ¨æœ‰ä¸€ä¸ªå®ƒåç»­çš„Sinkï¼Œå…¶æ¬¡é‡å†™å®ƒçš„accpetæ–¹æ³•å°±æ˜¯lambdaè¡¨è¾¾å¼å˜›ï¼Œä¼šå…ˆæ‰§è¡Œå½“å‰çš„lambdaå¼ä»¥åï¼Œè°ƒç”¨åç»­Sinkçš„acceptæ–¹æ³•ï¼Œä»¥æ­¤å®ç°å¯¹æ‰€æœ‰çš„lambdaè¡¨è¾¾å¼çš„ä¾æ¬¡æ‰§è¡Œï¼Œæ‰§è¡Œå®Œä»¥åå°±è¿”å›äº†ã€‚</p> <p>æ•´ä¸ªæµç¨‹å¤§æ¦‚å°±æ˜¯è¿™æ ·ã€‚</p> <h4 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="header-anchor">#</a> å‚è€ƒæ–‡æ¡£</h4> <p><a href="https://juejin.cn/post/7103718952626290695" target="_blank" rel="noopener noreferrer">Java8 Streamæºç ç²¾è®²ï¼ˆå››ï¼‰ï¼šä¸€æ–‡è¯´é€å››ç§ç»ˆæ­¢æ“ä½œ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/blog/java/base/Stream1.html" class="prev">
        Stream æºç è§£æï¼ˆä¸Šï¼‰
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.7b9df32b.js" defer></script><script src="/blog/assets/js/2.be714ec7.js" defer></script><script src="/blog/assets/js/1.26c7c9cc.js" defer></script><script src="/blog/assets/js/56.ace3e6e3.js" defer></script>
  </body>
</html>
