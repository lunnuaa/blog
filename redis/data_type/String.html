<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>String：数字 &amp; 字符串 | lun&#39;s blogs</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/blog/favicon.ico">
    <meta name="description" content="blog">
    
    <link rel="preload" href="/blog/assets/css/0.styles.56f5eb6c.css" as="style"><link rel="preload" href="/blog/assets/js/app.7b9df32b.js" as="script"><link rel="preload" href="/blog/assets/js/2.be714ec7.js" as="script"><link rel="preload" href="/blog/assets/js/1.26c7c9cc.js" as="script"><link rel="preload" href="/blog/assets/js/31.47592684.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.0d71bf2e.js"><link rel="prefetch" href="/blog/assets/js/11.cc81c248.js"><link rel="prefetch" href="/blog/assets/js/12.5e69cd14.js"><link rel="prefetch" href="/blog/assets/js/13.f0bc7bf2.js"><link rel="prefetch" href="/blog/assets/js/14.0188e855.js"><link rel="prefetch" href="/blog/assets/js/15.48a1e71e.js"><link rel="prefetch" href="/blog/assets/js/16.0f4182c9.js"><link rel="prefetch" href="/blog/assets/js/17.ec7b8f9d.js"><link rel="prefetch" href="/blog/assets/js/18.776522e2.js"><link rel="prefetch" href="/blog/assets/js/19.26561e06.js"><link rel="prefetch" href="/blog/assets/js/20.3e42feda.js"><link rel="prefetch" href="/blog/assets/js/21.fd4e7a00.js"><link rel="prefetch" href="/blog/assets/js/22.b59f6079.js"><link rel="prefetch" href="/blog/assets/js/23.e6b2d3ec.js"><link rel="prefetch" href="/blog/assets/js/24.736cfa99.js"><link rel="prefetch" href="/blog/assets/js/25.91176041.js"><link rel="prefetch" href="/blog/assets/js/26.146e299c.js"><link rel="prefetch" href="/blog/assets/js/27.56a57551.js"><link rel="prefetch" href="/blog/assets/js/28.13a846a1.js"><link rel="prefetch" href="/blog/assets/js/29.f71b59d6.js"><link rel="prefetch" href="/blog/assets/js/3.f34ea2f7.js"><link rel="prefetch" href="/blog/assets/js/30.bf0626f9.js"><link rel="prefetch" href="/blog/assets/js/32.63f20fc3.js"><link rel="prefetch" href="/blog/assets/js/33.4852d9ec.js"><link rel="prefetch" href="/blog/assets/js/34.4f467138.js"><link rel="prefetch" href="/blog/assets/js/35.17d26444.js"><link rel="prefetch" href="/blog/assets/js/36.d0059312.js"><link rel="prefetch" href="/blog/assets/js/37.fc856e5d.js"><link rel="prefetch" href="/blog/assets/js/38.dc6b373c.js"><link rel="prefetch" href="/blog/assets/js/39.f04e5b6a.js"><link rel="prefetch" href="/blog/assets/js/4.885368ff.js"><link rel="prefetch" href="/blog/assets/js/40.b378efa5.js"><link rel="prefetch" href="/blog/assets/js/41.3c800d8a.js"><link rel="prefetch" href="/blog/assets/js/42.8b804f0c.js"><link rel="prefetch" href="/blog/assets/js/43.832aa078.js"><link rel="prefetch" href="/blog/assets/js/44.d1121c11.js"><link rel="prefetch" href="/blog/assets/js/45.b3e8ede1.js"><link rel="prefetch" href="/blog/assets/js/46.01e4202b.js"><link rel="prefetch" href="/blog/assets/js/47.489850e9.js"><link rel="prefetch" href="/blog/assets/js/48.3bd88d5f.js"><link rel="prefetch" href="/blog/assets/js/49.08c6f759.js"><link rel="prefetch" href="/blog/assets/js/5.d1dbc0b1.js"><link rel="prefetch" href="/blog/assets/js/50.c900e52a.js"><link rel="prefetch" href="/blog/assets/js/51.a59d8fbf.js"><link rel="prefetch" href="/blog/assets/js/52.0c715d23.js"><link rel="prefetch" href="/blog/assets/js/53.07715a2f.js"><link rel="prefetch" href="/blog/assets/js/54.e0d8cc69.js"><link rel="prefetch" href="/blog/assets/js/55.1efa3b0b.js"><link rel="prefetch" href="/blog/assets/js/56.ace3e6e3.js"><link rel="prefetch" href="/blog/assets/js/57.221667c1.js"><link rel="prefetch" href="/blog/assets/js/58.a786e5bd.js"><link rel="prefetch" href="/blog/assets/js/59.8a6dde26.js"><link rel="prefetch" href="/blog/assets/js/6.7ee6eed6.js"><link rel="prefetch" href="/blog/assets/js/60.0192f277.js"><link rel="prefetch" href="/blog/assets/js/61.75813485.js"><link rel="prefetch" href="/blog/assets/js/62.d8de1a01.js"><link rel="prefetch" href="/blog/assets/js/63.a08485a4.js"><link rel="prefetch" href="/blog/assets/js/64.7d19f572.js"><link rel="prefetch" href="/blog/assets/js/65.3f290d9a.js"><link rel="prefetch" href="/blog/assets/js/66.73f49082.js"><link rel="prefetch" href="/blog/assets/js/67.cb22e678.js"><link rel="prefetch" href="/blog/assets/js/68.22dc7228.js"><link rel="prefetch" href="/blog/assets/js/69.1f450482.js"><link rel="prefetch" href="/blog/assets/js/7.153b9c62.js"><link rel="prefetch" href="/blog/assets/js/70.03205c0b.js"><link rel="prefetch" href="/blog/assets/js/71.5b98edf5.js"><link rel="prefetch" href="/blog/assets/js/72.8be00756.js"><link rel="prefetch" href="/blog/assets/js/73.5e60394c.js"><link rel="prefetch" href="/blog/assets/js/74.a1100b64.js"><link rel="prefetch" href="/blog/assets/js/75.b47153bc.js"><link rel="prefetch" href="/blog/assets/js/76.b881f0b9.js"><link rel="prefetch" href="/blog/assets/js/77.eef60dd8.js"><link rel="prefetch" href="/blog/assets/js/78.b52fa32f.js"><link rel="prefetch" href="/blog/assets/js/79.9adc486f.js"><link rel="prefetch" href="/blog/assets/js/80.10b21516.js"><link rel="prefetch" href="/blog/assets/js/81.12c11cbc.js"><link rel="prefetch" href="/blog/assets/js/82.df4ae15b.js"><link rel="prefetch" href="/blog/assets/js/83.078b9ed6.js"><link rel="prefetch" href="/blog/assets/js/84.2d8ccb46.js"><link rel="prefetch" href="/blog/assets/js/85.4d5e44f4.js"><link rel="prefetch" href="/blog/assets/js/86.c32dda95.js"><link rel="prefetch" href="/blog/assets/js/87.c28d1f54.js"><link rel="prefetch" href="/blog/assets/js/88.c06457bb.js"><link rel="prefetch" href="/blog/assets/js/89.1febc082.js"><link rel="prefetch" href="/blog/assets/js/90.37985dbe.js"><link rel="prefetch" href="/blog/assets/js/91.9c3ebd93.js"><link rel="prefetch" href="/blog/assets/js/vendors~docsearch.02634ae8.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.56f5eb6c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/logo.png" alt="lun's blogs" class="logo"> <span class="site-name can-hide">lun's blogs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/java/base/Exception.html" class="nav-link">
  异常
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Generics.html" class="nav-link">
  泛型
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Enum.html" class="nav-link">
  枚举
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Serialize.html" class="nav-link">
  Java序列化机制详解
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Proxy.html" class="nav-link">
  动态代理
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Annotation.html" class="nav-link">
  深入理解Java注解
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Stream1.html" class="nav-link">
  Stream源码分析(上)
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Stream2.html" class="nav-link">
  Stream源码分析(下)
</a></li></ul></div></div><div class="nav-item"><a href="/blog/java多线程/" class="nav-link">
  Java多线程
</a></div><div class="nav-item"><a href="/blog/jvm/" class="nav-link">
  JVM
</a></div><div class="nav-item"><a href="/blog/redis/" class="nav-link router-link-active">
  Redis
</a></div><div class="nav-item"><a href="/blog/blogs/" class="nav-link">
  随笔
</a></div><div class="nav-item"><a href="https://juejin.cn/user/2159878519134157" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/java/base/Exception.html" class="nav-link">
  异常
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Generics.html" class="nav-link">
  泛型
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Enum.html" class="nav-link">
  枚举
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Serialize.html" class="nav-link">
  Java序列化机制详解
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Proxy.html" class="nav-link">
  动态代理
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Annotation.html" class="nav-link">
  深入理解Java注解
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Stream1.html" class="nav-link">
  Stream源码分析(上)
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Stream2.html" class="nav-link">
  Stream源码分析(下)
</a></li></ul></div></div><div class="nav-item"><a href="/blog/java多线程/" class="nav-link">
  Java多线程
</a></div><div class="nav-item"><a href="/blog/jvm/" class="nav-link">
  JVM
</a></div><div class="nav-item"><a href="/blog/redis/" class="nav-link router-link-active">
  Redis
</a></div><div class="nav-item"><a href="/blog/blogs/" class="nav-link">
  随笔
</a></div><div class="nav-item"><a href="https://juejin.cn/user/2159878519134157" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/redis/" aria-current="page" class="sidebar-link">一、前言</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>二、Redis数据类型</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/redis/data_type/String.html" aria-current="page" class="active sidebar-link">String：数字 &amp; 字符串</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/redis/data_type/String.html#字符串常见命令" class="sidebar-link">字符串常见命令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/redis/data_type/String.html#基本读写-get-set" class="sidebar-link" style="padding-left:3rem;">基本读写：get/set</a></li><li class="sidebar-sub-header"><a href="/blog/redis/data_type/String.html#批量读写-mget" class="sidebar-link" style="padding-left:3rem;">批量读写：MGET</a></li><li class="sidebar-sub-header"><a href="/blog/redis/data_type/String.html#设置过期时间-ex" class="sidebar-link" style="padding-left:3rem;">设置过期时间：EX</a></li><li class="sidebar-sub-header"><a href="/blog/redis/data_type/String.html#查询过期时间-ttl" class="sidebar-link" style="padding-left:3rem;">查询过期时间：TTL</a></li><li class="sidebar-sub-header"><a href="/blog/redis/data_type/String.html#字符串拼接-append" class="sidebar-link" style="padding-left:3rem;">字符串拼接：append</a></li><li class="sidebar-sub-header"><a href="/blog/redis/data_type/String.html#查询长度-strlen" class="sidebar-link" style="padding-left:3rem;">查询长度：strlen</a></li><li class="sidebar-sub-header"><a href="/blog/redis/data_type/String.html#查询子串-range" class="sidebar-link" style="padding-left:3rem;">查询子串：range</a></li><li class="sidebar-sub-header"><a href="/blog/redis/data_type/String.html#设置字符串新值并返回旧值-getset" class="sidebar-link" style="padding-left:3rem;">设置字符串新值并返回旧值：getset</a></li><li class="sidebar-sub-header"><a href="/blog/redis/data_type/String.html#key不存在才生效-setnx" class="sidebar-link" style="padding-left:3rem;">key不存在才生效：SETNX</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/redis/data_type/String.html#数字相关命令" class="sidebar-link">数字相关命令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/redis/data_type/String.html#整数自增减-incr-decr" class="sidebar-link" style="padding-left:3rem;">整数自增减：incr/decr</a></li><li class="sidebar-sub-header"><a href="/blog/redis/data_type/String.html#做减法-decrby-incrby" class="sidebar-link" style="padding-left:3rem;">做减法：decrby/incrby</a></li><li class="sidebar-sub-header"><a href="/blog/redis/data_type/String.html#浮点加减-incrbyfloat" class="sidebar-link" style="padding-left:3rem;">浮点加减：incrbyfloat</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/redis/data_type/String.html#对象头信息-redisobject" class="sidebar-link">对象头信息：redisObject</a></li><li class="sidebar-sub-header"><a href="/blog/redis/data_type/String.html#string底层实现原理" class="sidebar-link">String底层实现原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/redis/data_type/String.html#_1、int-整数" class="sidebar-link">1、int：整数</a></li><li class="sidebar-sub-header"><a href="/blog/redis/data_type/String.html#sds的实现原理" class="sidebar-link">SDS的实现原理</a></li><li class="sidebar-sub-header"><a href="/blog/redis/data_type/String.html#sds-vs-cstring" class="sidebar-link" style="padding-left:3rem;">SDS vs Cstring</a></li><li class="sidebar-sub-header"><a href="/blog/redis/data_type/String.html#_2、embstr-小字符串" class="sidebar-link">2、embstr：小字符串</a></li><li class="sidebar-sub-header"><a href="/blog/redis/data_type/String.html#_3、row-大字符串" class="sidebar-link">3、row：大字符串</a></li><li class="sidebar-sub-header"><a href="/blog/redis/data_type/String.html#浮点数-处理为字符串" class="sidebar-link">浮点数：处理为字符串</a></li><li class="sidebar-sub-header"><a href="/blog/redis/data_type/String.html#字符串唯一约束-大小512mb" class="sidebar-link">字符串唯一约束：大小512MB</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/redis/data_type/String.html#string潜在的问题" class="sidebar-link">String潜在的问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/redis/data_type/String.html#_1、键值对数量的增长" class="sidebar-link">1、键值对数量的增长</a></li><li class="sidebar-sub-header"><a href="/blog/redis/data_type/String.html#_2、浪费内存空间" class="sidebar-link">2、浪费内存空间</a></li><li class="sidebar-sub-header"><a href="/blog/redis/data_type/String.html#键值对占用的最小内存空间-64b" class="sidebar-link" style="padding-left:3rem;">键值对占用的最小内存空间：64B</a></li></ul></li></ul></li><li><a href="/blog/redis/data_type/List.html" class="sidebar-link">List：链表 &amp; 队列 &amp; 栈</a></li><li><a href="/blog/redis/data_type/Hash.html" class="sidebar-link">Hash：哈希表</a></li><li><a href="/blog/redis/data_type/Set.html" class="sidebar-link">Set：无序，唯一的集合</a></li><li><a href="/blog/redis/data_type/ZSet.html" class="sidebar-link">Sorted Set：有序集合</a></li><li><a href="/blog/redis/data_type/Others.html" class="sidebar-link">其它数据结构简介</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>三、Redis功能特性</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>四、Redis高可用</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="string-数字-字符串"><a href="#string-数字-字符串" class="header-anchor">#</a> String：数字 &amp; 字符串</h1> <h2 id="字符串常见命令"><a href="#字符串常见命令" class="header-anchor">#</a> 字符串常见命令</h2> <h4 id="基本读写-get-set"><a href="#基本读写-get-set" class="header-anchor">#</a> 基本读写：get/set</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 基本命令:get/set</span>
SET <span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token punctuation">[</span>value<span class="token punctuation">]</span>    <span class="token comment"># SET name lin</span>
GET <span class="token punctuation">[</span>key<span class="token punctuation">]</span>            <span class="token comment"># GET name 返回&quot;lin&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="批量读写-mget"><a href="#批量读写-mget" class="header-anchor">#</a> 批量读写：MGET</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 批量执行:mget</span>
MSET <span class="token punctuation">[</span>key1<span class="token punctuation">]</span> <span class="token punctuation">[</span>value1<span class="token punctuation">]</span> <span class="token punctuation">[</span>key2<span class="token punctuation">]</span> <span class="token punctuation">[</span>value2<span class="token punctuation">]</span> 
MGET <span class="token punctuation">[</span>key1<span class="token punctuation">]</span> <span class="token punctuation">[</span>key2<span class="token punctuation">]</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="设置过期时间-ex"><a href="#设置过期时间-ex" class="header-anchor">#</a> 设置过期时间：EX</h4> <p>默认永不过期</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 过期时间为 1000 秒</span>
SET <span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token punctuation">[</span>value<span class="token punctuation">]</span> ex <span class="token number">1000</span>
<span class="token comment"># 也可以这样写</span>
SETEX <span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token number">1000</span> <span class="token punctuation">[</span>value<span class="token punctuation">]</span>
<span class="token comment"># 单位为毫秒</span>
psetex <span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token number">100000</span> <span class="token punctuation">[</span>value<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="查询过期时间-ttl"><a href="#查询过期时间-ttl" class="header-anchor">#</a> 查询过期时间：TTL</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 查询过期时间</span>
TTL <span class="token punctuation">[</span>key<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="字符串拼接-append"><a href="#字符串拼接-append" class="header-anchor">#</a> 字符串拼接：append</h4> <p>在字符串尾部追加字符串</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>get key
<span class="token string">&quot;value&quot;</span>
append key <span class="token number">1</span>
get key
<span class="token string">&quot;value1&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="查询长度-strlen"><a href="#查询长度-strlen" class="header-anchor">#</a> 查询长度：strlen</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>strlen <span class="token punctuation">[</span>key<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="查询子串-range"><a href="#查询子串-range" class="header-anchor">#</a> 查询子串：range</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># get hello &quot;hello world&quot;</span>
<span class="token comment"># 查询从 0 ~ 4的子串</span>
getrange hello <span class="token number">0</span> <span class="token number">4</span>
<span class="token string">&quot;hello&quot;</span>
<span class="token comment"># -1代表倒数第一个字符 -2代表倒数第二个字符</span>
getrange hello <span class="token number">0</span> <span class="token parameter variable">-1</span>
<span class="token string">&quot;hello world&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="设置字符串新值并返回旧值-getset"><a href="#设置字符串新值并返回旧值-getset" class="header-anchor">#</a> 设置字符串新值并返回旧值：getset</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 顾名思义 先get 再set</span>
getset db mysql
<span class="token string">&quot;redis&quot;</span>
get db
<span class="token string">&quot;mysql&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="key不存在才生效-setnx"><a href="#key不存在才生效-setnx" class="header-anchor">#</a> key不存在才生效：SETNX</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 如果 key 已经存在，命令无效</span>
setnx <span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token punctuation">[</span>value<span class="token punctuation">]</span>
<span class="token comment"># 这个也可以批量</span>
msetnx <span class="token punctuation">[</span>key1<span class="token punctuation">]</span> <span class="token punctuation">[</span>value1<span class="token punctuation">]</span> <span class="token punctuation">[</span>key2<span class="token punctuation">]</span> <span class="token punctuation">[</span>value2<span class="token punctuation">]</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>需要注意的是：msetnx是原子性操作，如果有一个已经存在的key，那么全部键值都会设置失败</p> <h2 id="数字相关命令"><a href="#数字相关命令" class="header-anchor">#</a> 数字相关命令</h2> <h4 id="整数自增减-incr-decr"><a href="#整数自增减-incr-decr" class="header-anchor">#</a> 整数自增减：incr/decr</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>incr <span class="token punctuation">[</span>key<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="做减法-decrby-incrby"><a href="#做减法-decrby-incrby" class="header-anchor">#</a> 做减法：decrby/incrby</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>decrby <span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token punctuation">[</span>diff<span class="token punctuation">]</span>
<span class="token comment"># value -= diff</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="浮点加减-incrbyfloat"><a href="#浮点加减-incrbyfloat" class="header-anchor">#</a> 浮点加减：incrbyfloat</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>incrbyfloat <span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token punctuation">[</span>diff<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="对象头信息-redisobject"><a href="#对象头信息-redisobject" class="header-anchor">#</a> 对象头信息：redisObject</h2> <p>在了解String底层原理之前，不得不先说的是：redisObject。</p> <p>在 Redis 中，所有的对象都会包含 redisObject 对象头，redisObject  包含了数据类型的元数据，具体的信息如下</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">// redisObject共16字节如下</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">redisObject</span> <span class="token punctuation">{</span>
    <span class="token keyword">unsigned</span> type<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">;</span> 		<span class="token comment">// 4 bit type 如string、list、hash</span>
    <span class="token keyword">unsigned</span> encoding<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">;</span> 	<span class="token comment">// 4 bit</span>
    <span class="token keyword">unsigned</span> lru<span class="token operator">:</span>LRU_BITS<span class="token punctuation">;</span>  <span class="token comment">// 3字节</span>
    <span class="token keyword">int</span> refcount<span class="token punctuation">;</span> 			<span class="token comment">// 4字节 引用计数器</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">;</span> 				<span class="token comment">// 8 个字节 指向具体的内容</span>
<span class="token punctuation">}</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>典型的 redisObject 如下图：</p> <img src="/blog/assets/img/image-20231207115647634.e8eaee7b.png" alt="./image-20231207115647634" style="zoom:33%;"> <p>Redis通过 redisObject 知道数据类型是 String 从而找到真正的数据。</p> <h2 id="string底层实现原理"><a href="#string底层实现原理" class="header-anchor">#</a> String底层实现原理</h2> <p>Redis内部有三种内部数据类型。</p> <h3 id="_1、int-整数"><a href="#_1、int-整数" class="header-anchor">#</a> 1、int：整数</h3> <p>如果String本身是一个不超过C语言long类型的整数值：</p> <p>那么，String不是广为人知的SDS，而是直接将redisObject中的：</p> <div class="language-C line-numbers-mode"><pre class="language-c"><code> <span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">;</span> <span class="token comment">// 8 个字节 指向具体的内容</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>转换成C语言的long（也是8个字节），存储在头信息中，不占用别的内容了。</p> <h3 id="sds的实现原理"><a href="#sds的实现原理" class="header-anchor">#</a> SDS的实现原理</h3> <p>在介绍下面两个数据类型前，先来了解SDS，因为它们都基于SDS。</p> <p>Redis 3.2，根据字符串长度选择不同的结构体，仅列出部分如下：</p> <div class="language-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">// 一共有 5 种 第一个是 1&lt;&lt;5  最大是1&lt;&lt;64</span>
<span class="token comment">// 对应的字符串长度小于 1&lt;&lt;8</span>
<span class="token keyword">struct</span> <span class="token keyword">__attribute__</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>__packed__<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token class-name">sdshdr8</span> <span class="token punctuation">{</span>
    <span class="token class-name">uint8_t</span> len<span class="token punctuation">;</span> <span class="token comment">// 已使用长度，1 字节存储 </span>
    <span class="token class-name">uint8_t</span> alloc<span class="token punctuation">;</span> <span class="token comment">// 总长度 1字节</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> flags<span class="token punctuation">;</span> 
    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 真正存储字符串的数据空间</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 对应的字符串长度小于 1&lt;&lt;32</span>
<span class="token keyword">struct</span> <span class="token keyword">__attribute__</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>__packed__<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token class-name">sdshdr32</span> <span class="token punctuation">{</span> 
    <span class="token class-name">uint32_t</span> len<span class="token punctuation">;</span> <span class="token comment">// 4字节</span>
    <span class="token class-name">uint32_t</span> alloc<span class="token punctuation">;</span> <span class="token comment">// 4字节</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> flags<span class="token punctuation">;</span> 
    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="sds-vs-cstring"><a href="#sds-vs-cstring" class="header-anchor">#</a> SDS vs Cstring</h4> <table><thead><tr><th>SDS</th> <th>Cstring</th></tr></thead> <tbody><tr><td>获取字符串长度复杂度为 O(1)</td> <td>获取字符串长度复杂度为 O(n)</td></tr> <tr><td>修改字符串时，<strong>最多</strong>需要执行 N 次内存重分配</td> <td>一定是 N 次</td></tr> <tr><td>可以保存二进制数据</td> <td>不能</td></tr></tbody></table> <h3 id="_2、embstr-小字符串"><a href="#_2、embstr-小字符串" class="header-anchor">#</a> 2、embstr：小字符串</h3> <p>当字符串长度小于等于 44 字节，为embstr 类型。</p> <p><strong>embstr的特点是：redisObject和SDS连续</strong></p> <img src="/blog/assets/img/image-20231207115640849.a9a6b4cc.png" alt="image-20231207115640849" style="zoom:33%;"> <p>连续的好处自然是能够<strong>提升性能</strong></p> <p>缺点是：当字符串长度变化，不仅仅SDS，连redisObject都需要重新分配空间并初始化，因此当修改使得超出当前SDS的len时，修改的效率低。</p> <h3 id="_3、row-大字符串"><a href="#_3、row-大字符串" class="header-anchor">#</a> 3、row：大字符串</h3> <p>当字符串长度大于 44 字节时，会变为 raw 类型存储。</p> <p><strong>row的特点是：redisObject和SDS不连续，这意味着额外的一次内存分配</strong></p> <img src="/blog/assets/img/image-20231207115647634.e8eaee7b.png" alt="image-20231207115647634" style="zoom:33%;"> <p>好处是修改的性能比embstr高。</p> <h3 id="浮点数-处理为字符串"><a href="#浮点数-处理为字符串" class="header-anchor">#</a> 浮点数：处理为字符串</h3> <p>浮点数并不会类似long被处理为8位的double，而是像字符串一样被处理</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 短浮点:embstr</span>
<span class="token builtin class-name">set</span> testfloat <span class="token number">1.112</span>
object encoding testfloat
<span class="token string">&quot;embstr&quot;</span>
<span class="token comment"># 长浮点:raw</span>
<span class="token builtin class-name">set</span> testfloat <span class="token number">1.112344444444444444444444444444444444444</span><span class="token punctuation">..</span>.
object encoding testfloat
<span class="token string">&quot;raw&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="字符串唯一约束-大小512mb"><a href="#字符串唯一约束-大小512mb" class="header-anchor">#</a> 字符串唯一约束：大小512MB</h3> <p>Redis的字符串用途十分广泛，因此几乎没有约束，也可以直接用来存储二进制格式的文件，比如jpeg格式图片。</p> <p>唯一约束是：大小不可超过512MB。</p> <h2 id="string潜在的问题"><a href="#string潜在的问题" class="header-anchor">#</a> String潜在的问题</h2> <h3 id="_1、键值对数量的增长"><a href="#_1、键值对数量的增长" class="header-anchor">#</a> 1、键值对数量的增长</h3> <p>String作为V，只表达了一个键值对，相对其它数据类型，保存的信息最少，由于Redis使用哈希表组织整个数据库，这会导致哈希冲突概率提高，访问效率变低。RDB的效率也会受影响。</p> <h3 id="_2、浪费内存空间"><a href="#_2、浪费内存空间" class="header-anchor">#</a> 2、浪费内存空间</h3> <h4 id="键值对占用的最小内存空间-64b"><a href="#键值对占用的最小内存空间-64b" class="header-anchor">#</a> 键值对占用的最小内存空间：64B</h4> <p>由于对Long的优化，RedisObject即可表达它的大小，没有任何额外的内存空间，但是：</p> <p><strong>一个Long本该只有8字节，但在Redis中以K-V形式存储却需要占用64B</strong>。</p> <ul><li>由于Redis的内存分配原则，key,value,next三个指针24B，一个Long在Redis全局字典中就首先占用32B；</li> <li>其次一个RedisObject就16字节，K-V各一个，就总共占用了32B。</li></ul> <p>加起来共64B，所以如果存在大量的Long型字符串，对内存空间是非常不友好的。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/redis/" class="prev router-link-active">
        一、前言
      </a></span> <span class="next"><a href="/blog/redis/data_type/List.html">
        List：链表 &amp; 队列 &amp; 栈
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.7b9df32b.js" defer></script><script src="/blog/assets/js/2.be714ec7.js" defer></script><script src="/blog/assets/js/1.26c7c9cc.js" defer></script><script src="/blog/assets/js/31.47592684.js" defer></script>
  </body>
</html>
