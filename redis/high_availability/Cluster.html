<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redis集群：Redis cluster | lun&#39;s blogs</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/blog/favicon.ico">
    <meta name="description" content="blog">
    
    <link rel="preload" href="/blog/assets/css/0.styles.56f5eb6c.css" as="style"><link rel="preload" href="/blog/assets/js/app.7b9df32b.js" as="script"><link rel="preload" href="/blog/assets/js/2.be714ec7.js" as="script"><link rel="preload" href="/blog/assets/js/1.26c7c9cc.js" as="script"><link rel="preload" href="/blog/assets/js/45.b3e8ede1.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.0d71bf2e.js"><link rel="prefetch" href="/blog/assets/js/11.cc81c248.js"><link rel="prefetch" href="/blog/assets/js/12.5e69cd14.js"><link rel="prefetch" href="/blog/assets/js/13.f0bc7bf2.js"><link rel="prefetch" href="/blog/assets/js/14.0188e855.js"><link rel="prefetch" href="/blog/assets/js/15.48a1e71e.js"><link rel="prefetch" href="/blog/assets/js/16.0f4182c9.js"><link rel="prefetch" href="/blog/assets/js/17.ec7b8f9d.js"><link rel="prefetch" href="/blog/assets/js/18.776522e2.js"><link rel="prefetch" href="/blog/assets/js/19.26561e06.js"><link rel="prefetch" href="/blog/assets/js/20.3e42feda.js"><link rel="prefetch" href="/blog/assets/js/21.fd4e7a00.js"><link rel="prefetch" href="/blog/assets/js/22.b59f6079.js"><link rel="prefetch" href="/blog/assets/js/23.e6b2d3ec.js"><link rel="prefetch" href="/blog/assets/js/24.736cfa99.js"><link rel="prefetch" href="/blog/assets/js/25.91176041.js"><link rel="prefetch" href="/blog/assets/js/26.146e299c.js"><link rel="prefetch" href="/blog/assets/js/27.56a57551.js"><link rel="prefetch" href="/blog/assets/js/28.13a846a1.js"><link rel="prefetch" href="/blog/assets/js/29.f71b59d6.js"><link rel="prefetch" href="/blog/assets/js/3.f34ea2f7.js"><link rel="prefetch" href="/blog/assets/js/30.bf0626f9.js"><link rel="prefetch" href="/blog/assets/js/31.47592684.js"><link rel="prefetch" href="/blog/assets/js/32.63f20fc3.js"><link rel="prefetch" href="/blog/assets/js/33.4852d9ec.js"><link rel="prefetch" href="/blog/assets/js/34.4f467138.js"><link rel="prefetch" href="/blog/assets/js/35.17d26444.js"><link rel="prefetch" href="/blog/assets/js/36.d0059312.js"><link rel="prefetch" href="/blog/assets/js/37.fc856e5d.js"><link rel="prefetch" href="/blog/assets/js/38.dc6b373c.js"><link rel="prefetch" href="/blog/assets/js/39.f04e5b6a.js"><link rel="prefetch" href="/blog/assets/js/4.885368ff.js"><link rel="prefetch" href="/blog/assets/js/40.b378efa5.js"><link rel="prefetch" href="/blog/assets/js/41.3c800d8a.js"><link rel="prefetch" href="/blog/assets/js/42.8b804f0c.js"><link rel="prefetch" href="/blog/assets/js/43.832aa078.js"><link rel="prefetch" href="/blog/assets/js/44.d1121c11.js"><link rel="prefetch" href="/blog/assets/js/46.01e4202b.js"><link rel="prefetch" href="/blog/assets/js/47.489850e9.js"><link rel="prefetch" href="/blog/assets/js/48.3bd88d5f.js"><link rel="prefetch" href="/blog/assets/js/49.08c6f759.js"><link rel="prefetch" href="/blog/assets/js/5.d1dbc0b1.js"><link rel="prefetch" href="/blog/assets/js/50.c900e52a.js"><link rel="prefetch" href="/blog/assets/js/51.a59d8fbf.js"><link rel="prefetch" href="/blog/assets/js/52.0c715d23.js"><link rel="prefetch" href="/blog/assets/js/53.07715a2f.js"><link rel="prefetch" href="/blog/assets/js/54.e0d8cc69.js"><link rel="prefetch" href="/blog/assets/js/55.1efa3b0b.js"><link rel="prefetch" href="/blog/assets/js/56.ace3e6e3.js"><link rel="prefetch" href="/blog/assets/js/57.221667c1.js"><link rel="prefetch" href="/blog/assets/js/58.a786e5bd.js"><link rel="prefetch" href="/blog/assets/js/59.8a6dde26.js"><link rel="prefetch" href="/blog/assets/js/6.7ee6eed6.js"><link rel="prefetch" href="/blog/assets/js/60.0192f277.js"><link rel="prefetch" href="/blog/assets/js/61.75813485.js"><link rel="prefetch" href="/blog/assets/js/62.d8de1a01.js"><link rel="prefetch" href="/blog/assets/js/63.a08485a4.js"><link rel="prefetch" href="/blog/assets/js/64.7d19f572.js"><link rel="prefetch" href="/blog/assets/js/65.3f290d9a.js"><link rel="prefetch" href="/blog/assets/js/66.73f49082.js"><link rel="prefetch" href="/blog/assets/js/67.cb22e678.js"><link rel="prefetch" href="/blog/assets/js/68.22dc7228.js"><link rel="prefetch" href="/blog/assets/js/69.1f450482.js"><link rel="prefetch" href="/blog/assets/js/7.153b9c62.js"><link rel="prefetch" href="/blog/assets/js/70.03205c0b.js"><link rel="prefetch" href="/blog/assets/js/71.5b98edf5.js"><link rel="prefetch" href="/blog/assets/js/72.8be00756.js"><link rel="prefetch" href="/blog/assets/js/73.5e60394c.js"><link rel="prefetch" href="/blog/assets/js/74.a1100b64.js"><link rel="prefetch" href="/blog/assets/js/75.b47153bc.js"><link rel="prefetch" href="/blog/assets/js/76.b881f0b9.js"><link rel="prefetch" href="/blog/assets/js/77.eef60dd8.js"><link rel="prefetch" href="/blog/assets/js/78.b52fa32f.js"><link rel="prefetch" href="/blog/assets/js/79.9adc486f.js"><link rel="prefetch" href="/blog/assets/js/80.10b21516.js"><link rel="prefetch" href="/blog/assets/js/81.12c11cbc.js"><link rel="prefetch" href="/blog/assets/js/82.df4ae15b.js"><link rel="prefetch" href="/blog/assets/js/83.078b9ed6.js"><link rel="prefetch" href="/blog/assets/js/84.2d8ccb46.js"><link rel="prefetch" href="/blog/assets/js/85.4d5e44f4.js"><link rel="prefetch" href="/blog/assets/js/86.c32dda95.js"><link rel="prefetch" href="/blog/assets/js/87.c28d1f54.js"><link rel="prefetch" href="/blog/assets/js/88.c06457bb.js"><link rel="prefetch" href="/blog/assets/js/89.1febc082.js"><link rel="prefetch" href="/blog/assets/js/90.37985dbe.js"><link rel="prefetch" href="/blog/assets/js/91.9c3ebd93.js"><link rel="prefetch" href="/blog/assets/js/vendors~docsearch.02634ae8.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.56f5eb6c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/logo.png" alt="lun's blogs" class="logo"> <span class="site-name can-hide">lun's blogs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/java/base/Exception.html" class="nav-link">
  异常
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Generics.html" class="nav-link">
  泛型
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Enum.html" class="nav-link">
  枚举
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Serialize.html" class="nav-link">
  Java序列化机制详解
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Proxy.html" class="nav-link">
  动态代理
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Annotation.html" class="nav-link">
  深入理解Java注解
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Stream1.html" class="nav-link">
  Stream源码分析(上)
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Stream2.html" class="nav-link">
  Stream源码分析(下)
</a></li></ul></div></div><div class="nav-item"><a href="/blog/java多线程/" class="nav-link">
  Java多线程
</a></div><div class="nav-item"><a href="/blog/jvm/" class="nav-link">
  JVM
</a></div><div class="nav-item"><a href="/blog/redis/" class="nav-link router-link-active">
  Redis
</a></div><div class="nav-item"><a href="/blog/blogs/" class="nav-link">
  随笔
</a></div><div class="nav-item"><a href="https://juejin.cn/user/2159878519134157" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/java/base/Exception.html" class="nav-link">
  异常
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Generics.html" class="nav-link">
  泛型
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Enum.html" class="nav-link">
  枚举
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Serialize.html" class="nav-link">
  Java序列化机制详解
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Proxy.html" class="nav-link">
  动态代理
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Annotation.html" class="nav-link">
  深入理解Java注解
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Stream1.html" class="nav-link">
  Stream源码分析(上)
</a></li><li class="dropdown-item"><!----> <a href="/blog/java/base/Stream2.html" class="nav-link">
  Stream源码分析(下)
</a></li></ul></div></div><div class="nav-item"><a href="/blog/java多线程/" class="nav-link">
  Java多线程
</a></div><div class="nav-item"><a href="/blog/jvm/" class="nav-link">
  JVM
</a></div><div class="nav-item"><a href="/blog/redis/" class="nav-link router-link-active">
  Redis
</a></div><div class="nav-item"><a href="/blog/blogs/" class="nav-link">
  随笔
</a></div><div class="nav-item"><a href="https://juejin.cn/user/2159878519134157" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/redis/" aria-current="page" class="sidebar-link">一、前言</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>二、Redis数据类型</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>三、Redis功能特性</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>四、Redis高可用</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/redis/high_availability/MasterSlave.html" class="sidebar-link">主从架构 Redis</a></li><li><a href="/blog/redis/high_availability/Sentinel.html" class="sidebar-link">哨兵（Sentinel）</a></li><li><a href="/blog/redis/high_availability/Cluster.html" aria-current="page" class="active sidebar-link">Redis集群：Redis cluster</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#集群快速开始" class="sidebar-link">集群快速开始</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#一、create-cluster-工具" class="sidebar-link">一、create-cluster 工具</a></li><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#二、手动创建集群" class="sidebar-link">二、手动创建集群</a></li><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#_1、开启集群模式" class="sidebar-link" style="padding-left:3rem;">1、开启集群模式</a></li><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#_2、启动redis" class="sidebar-link" style="padding-left:3rem;">2、启动Redis</a></li><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#_3、创建集群" class="sidebar-link" style="padding-left:3rem;">3、创建集群</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#集群实现原理" class="sidebar-link">集群实现原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#全局角度下的redis集群" class="sidebar-link">全局角度下的Redis集群</a></li><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#数据分片-hash-slot" class="sidebar-link">数据分片：hash slot</a></li><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#如何实现重新分片" class="sidebar-link">如何实现重新分片</a></li><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#hash-slot-的好处" class="sidebar-link" style="padding-left:3rem;">hash slot 的好处</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#客户端如何访问集群redis" class="sidebar-link">客户端如何访问集群Redis</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#_1、moved-重定向" class="sidebar-link">1、MOVED：重定向</a></li><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#_2、ask-错误" class="sidebar-link">2、ASK：错误</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#集群模式的高可用" class="sidebar-link">集群模式的高可用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#集群与主从不冲突" class="sidebar-link">集群与主从不冲突</a></li><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#集群不需要哨兵" class="sidebar-link" style="padding-left:3rem;">集群不需要哨兵</a></li><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#集群下哨兵功能的实现" class="sidebar-link">集群下哨兵功能的实现</a></li><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#_1、监控" class="sidebar-link" style="padding-left:3rem;">1、监控</a></li><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#_2、自动故障恢复" class="sidebar-link" style="padding-left:3rem;">2、自动故障恢复</a></li><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#如何选定新的主节点-投票" class="sidebar-link" style="padding-left:3rem;">如何选定新的主节点：投票</a></li><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#如何成为新的主节点" class="sidebar-link" style="padding-left:3rem;">如何成为新的主节点</a></li><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#集群间如何通信" class="sidebar-link">集群间如何通信</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#集群常用命令" class="sidebar-link">集群常用命令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#查看集群信息-info" class="sidebar-link" style="padding-left:3rem;">查看集群信息： info</a></li><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#查看节点信息-nodes" class="sidebar-link" style="padding-left:3rem;">查看节点信息： nodes</a></li><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#动态操作" class="sidebar-link">动态操作</a></li><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#添加主节点-meet" class="sidebar-link" style="padding-left:3rem;">添加主节点：meet</a></li><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#添加从节点-replicate" class="sidebar-link" style="padding-left:3rem;">添加从节点：replicate</a></li><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#移除节点-forget" class="sidebar-link" style="padding-left:3rem;">移除节点：forget</a></li><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#重新分片-reshard" class="sidebar-link" style="padding-left:3rem;">重新分片：reshard</a></li><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#负载均衡-rebalance" class="sidebar-link" style="padding-left:3rem;">负载均衡：rebalance</a></li><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#手动分片-addslots" class="sidebar-link" style="padding-left:3rem;">手动分片：addslots</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#集群模式对涉及多个-key-的操作的影响" class="sidebar-link">集群模式对涉及多个 key 的操作的影响</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#为什么是-slot-而非-node" class="sidebar-link">为什么是 slot 而非 node</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#解决方案" class="sidebar-link">解决方案</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#_1、hashtags-保证-key-在同一节点" class="sidebar-link">1、HashTags：保证 key 在同一节点</a></li><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#_2、考虑数据类型的设计" class="sidebar-link">2、考虑数据类型的设计</a></li><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#_3、eval-flags-allow-cross-slot-keys" class="sidebar-link">3、Eval Flags：allow-cross-slot-keys</a></li><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#_4、考虑不使用集群模式" class="sidebar-link">4、考虑不使用集群模式</a></li><li class="sidebar-sub-header"><a href="/blog/redis/high_availability/Cluster.html#参考文档" class="sidebar-link" style="padding-left:3rem;">参考文档</a></li></ul></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="redis集群-redis-cluster"><a href="#redis集群-redis-cluster" class="header-anchor">#</a> Redis集群：Redis cluster</h1> <p>集群，就是使用多台Redis服务器构成一个整体，提供服务。和主从不同的是，集群的主节点存储的数据是不同的</p> <p>Redis Cluster是Redis官方提供的一种对分片集群的实现。</p> <h3 id="集群的意义"><a href="#集群的意义" class="header-anchor">#</a> 集群的意义</h3> <p>随着项目规模的扩大，单机Redis的内存不足以存储这么多数据。即便能够存储，内存占用很高也会影响性能。</p> <p>因此我们需要将数据分片存储。</p> <h2 id="集群快速开始"><a href="#集群快速开始" class="header-anchor">#</a> 集群快速开始</h2> <h3 id="一、create-cluster-工具"><a href="#一、create-cluster-工具" class="header-anchor">#</a> 一、create-cluster 工具</h3> <p>create-cluster工具是官方提供的快速搭建集群工具，在 utils/create-cluster 目录下</p> <p>集群的所有节点只能在同一台服务器上，所以一般只能用来测试，并不能在生产环境这样搭建，命令如下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>./create-cluster start  <span class="token comment"># 创建集群</span>
./create-cluster create <span class="token comment"># 组建集群 输入 yes 3 主 3 从</span>
redis-cli <span class="token parameter variable">-c</span> <span class="token parameter variable">-p</span> <span class="token number">30001</span>   <span class="token comment"># 连接</span>
./create-cluster stop   <span class="token comment"># 关闭集群</span>
./create-cluster clean  <span class="token comment"># 清理集群</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="二、手动创建集群"><a href="#二、手动创建集群" class="header-anchor">#</a> 二、手动创建集群</h3> <h4 id="_1、开启集群模式"><a href="#_1、开启集群模式" class="header-anchor">#</a> 1、开启集群模式</h4> <p>所有节点，不管主从，都需要开启</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>cluster-enabled <span class="token function">yes</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_2、启动redis"><a href="#_2、启动redis" class="header-anchor">#</a> 2、启动Redis</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>./src/redis-server redis.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_3、创建集群"><a href="#_3、创建集群" class="header-anchor">#</a> 3、创建集群</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 所有节点</span>
<span class="token comment"># n表示一个主节点对应n个从节点</span>
redis-cli <span class="token parameter variable">--cluster</span> create <span class="token punctuation">[</span>ip1:port1<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">127</span>:30001<span class="token punctuation">]</span> <span class="token punctuation">[</span>ip3:port3<span class="token punctuation">]</span><span class="token punctuation">..</span>. --cluster-replicas <span class="token punctuation">[</span>n<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="集群实现原理"><a href="#集群实现原理" class="header-anchor">#</a> 集群实现原理</h2> <h3 id="全局角度下的redis集群"><a href="#全局角度下的redis集群" class="header-anchor">#</a> 全局角度下的Redis集群</h3> <p>从整体上来说，Redis集群可以认为是一个很大的Redis数据库，但我们知道数据是存储在不同的节点上的。</p> <p>因此我们需要知道：哪些数据存储在哪个Redis节点？</p> <h3 id="数据分片-hash-slot"><a href="#数据分片-hash-slot" class="header-anchor">#</a> 数据分片：hash slot</h3> <p>数据分片，是一种将数据区分存储的手段。</p> <p>Redis 集群将所有的数据分为 16384 个 slots（槽），每个节点负责其中的一部分槽位。</p> <p>当进行数据操作时，操作会被发送给集群中的某一个节点，Redis会根据key定位slot。Redis默认使用 CRC16 算法对key进行 hash 得到一个整数值% 16384，从而定位slot。</p> <p>如果slot不属于该节点的处理范围，该Redis会将请求转发给目标节点。</p> <h3 id="如何实现重新分片"><a href="#如何实现重新分片" class="header-anchor">#</a> 如何实现重新分片</h3> <p>重新分片的时机：当集群的节点动态增减，或是我们手动进行数据重新分片。</p> <p>我们知道：数据和节点是没关系的，数据只和slot有关系，而重新分片修改的是节点负责的slot范围。</p> <p>因此只需要：</p> <ul><li>将不属于自己的slot的数据，交付给将要负责的节点</li> <li>向自己将要负责的slot的数据所在的节点，获取数据</li></ul> <p>即可。</p> <h4 id="hash-slot-的好处"><a href="#hash-slot-的好处" class="header-anchor">#</a> hash slot 的好处</h4> <p>1.解耦数据和节点之间的关系，简化了节点扩容和收缩难度。</p> <p>2.节点自身维护槽的映射关系，不需要客户端或者代理服务维护槽分区元数据。</p> <p>3.支持节点、槽、键之间的映射查询，用于数据路由，在线伸缩等场景。</p> <p>4.无论数据规模大，还是小，Redis虚拟槽分区各个节点的负载，都会比较均衡 。而一致性哈希在大批量的数据场景下负载更加均衡，但是在数据规模小的场景下，会出现单位时间内某个节点完全空闲的情况出现</p> <p>当节点扩容或者缩容时，对数据槽进行重新分配迁移即可，数据不会丢失，可扩展性强。</p> <h2 id="客户端如何访问集群redis"><a href="#客户端如何访问集群redis" class="header-anchor">#</a> 客户端如何访问集群Redis</h2> <p>客户端是如何找到目标key所在的Redis节点的？</p> <p>集群的每个节点都有hash slot的分配信息，在客户端初次访问时，节点也会将hash slot的分配信息发给客户端。</p> <p>因此，<strong>客户端也持有hash slot的分配信息</strong>，从而能够决定将key发给哪个节点。</p> <p>但是，hash slot可能变化，比如rebalance负载均衡，因此Redis提供了如下两种机制来应对不同的情况：</p> <h3 id="_1、moved-重定向"><a href="#_1、moved-重定向" class="header-anchor">#</a> 1、MOVED：重定向</h3> <p>此时，hash slot已经发生变化，并且『原先客户端认为slot所在的节点』知道该slot目前是谁负责，就会返回一个</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># key 对应的 hash slot</span>
<span class="token comment"># key 所在的 节点IP port</span>
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> MOVED <span class="token punctuation">[</span>hash slot<span class="token punctuation">]</span> <span class="token punctuation">[</span>IP:port<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>同时，客户端修改本地的缓存信息。</p> <h3 id="_2、ask-错误"><a href="#_2、ask-错误" class="header-anchor">#</a> 2、ASK：错误</h3> <p>MOVED忽略的一个问题是：slot对应的所有数据可能没有完全传递给新节点。此时会返回一个</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># ASK 表示数据正在迁移</span>
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> ASK <span class="token punctuation">[</span>hash slot<span class="token punctuation">]</span> <span class="token punctuation">[</span>IP:port<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>接着客户端需要给这个新的节点发送一个ASKING</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 让这个实例允许执行客户端接下来发送的命令</span>
ASKING 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>然后才发送操作命令</p> <blockquote><p><strong>ASK 命令不会更新客户端缓存的哈希槽分配信息</strong></p></blockquote> <h2 id="集群模式的高可用"><a href="#集群模式的高可用" class="header-anchor">#</a> 集群模式的高可用</h2> <p>集群模式虽然实现了数据分片存储，但数据存储在单个Redis节点仍然有单点故障风险，因此：集群与主从不冲突</p> <h3 id="集群与主从不冲突"><a href="#集群与主从不冲突" class="header-anchor">#</a> 集群与主从不冲突</h3> <p>集群架构下的一个Redis，通常也会使用主从架构进行部署。</p> <h4 id="集群不需要哨兵"><a href="#集群不需要哨兵" class="header-anchor">#</a> 集群不需要哨兵</h4> <p>既然部署了主从，需要哨兵吗？答案是不需要。集群中的各个节点本身就承担了哨兵的工作。</p> <h3 id="集群下哨兵功能的实现"><a href="#集群下哨兵功能的实现" class="header-anchor">#</a> 集群下哨兵功能的实现</h3> <h4 id="_1、监控"><a href="#_1、监控" class="header-anchor">#</a> 1、监控</h4> <p>这与哨兵机制非常类似，也依赖于心跳机制。</p> <p>节点会定期向其他节点发送ping，没有收到pong，就认为<strong>主观宕机</strong>（疑似下线）</p> <p>超半数节点认为主观宕机，就是<strong>客观宕机</strong>（确定下线）。</p> <h4 id="_2、自动故障恢复"><a href="#_2、自动故障恢复" class="header-anchor">#</a> 2、自动故障恢复</h4> <p>对客观宕机的 master node，从其所有的 slave node 中，选择一个切换成 master node。</p> <h4 id="如何选定新的主节点-投票"><a href="#如何选定新的主节点-投票" class="header-anchor">#</a> 如何选定新的主节点：投票</h4> <p>从节点发现主节点宕机，广播消息表示：“我想当主节点”。</p> <p>只有主节点有投票的权力，主节点会给第一个发给自己“我想当主节点”的节点投票。</p> <p>获得超过半数票的节点成为新的主节点。</p> <h4 id="如何成为新的主节点"><a href="#如何成为新的主节点" class="header-anchor">#</a> 如何成为新的主节点</h4> <p>新的主节点会执行<code>SLAVEOF NO ONE</code>命令，转变为主节点，接手宕机的节点负责的slots，并通知其它节点。</p> <h3 id="集群间如何通信"><a href="#集群间如何通信" class="header-anchor">#</a> 集群间如何通信</h3> <p>如果你的Redis端口号为6379，则会开启16379（+10000）作为通信专用的端口。</p> <h2 id="集群常用命令"><a href="#集群常用命令" class="header-anchor">#</a> 集群常用命令</h2> <h4 id="查看集群信息-info"><a href="#查看集群信息-info" class="header-anchor">#</a> 查看集群信息： info</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>redis-cli <span class="token parameter variable">-c</span> <span class="token parameter variable">-p</span> <span class="token number">30001</span> <span class="token comment"># 连接到集群</span>
cluster info <span class="token comment"># 查看集群信息</span>
<span class="token comment"># ...</span>
cluster_known_nodes:6 <span class="token comment"># 集群的节点数</span>
cluster_size:3 <span class="token comment"># 集群主节点数</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="查看节点信息-nodes"><a href="#查看节点信息-nodes" class="header-anchor">#</a> 查看节点信息： nodes</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>cluster nodes
<span class="token comment"># myself:命令接收方</span>
<span class="token comment"># 槽位 0-5460</span>
445f2a86fe36d397613839d8cc1ae6702c976593 <span class="token number">127.0</span>.0.1:30001@40001 myself,master - <span class="token number">0</span> <span class="token number">1585125835000</span> <span class="token number">1</span> connected <span class="token number">0</span>-5460
64828ab44566fc5ad656e831fd33de87be1387a0 <span class="token number">127.0</span>.0.1:30004@40004 slave 445f2a86fe36d397613839d8cc1ae6702c976593 <span class="token number">0</span> <span class="token number">1585125835000</span> <span class="token number">4</span> connected
<span class="token comment"># 40001 = 30001 + 1 用于集群间通信 </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="动态操作"><a href="#动态操作" class="header-anchor">#</a> 动态操作</h3> <p>以下命令可以在集群工作时，动态的修改集群。</p> <h4 id="添加主节点-meet"><a href="#添加主节点-meet" class="header-anchor">#</a> 添加主节点：meet</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>cluster meet [ip]:[port]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="添加从节点-replicate"><a href="#添加从节点-replicate" class="header-anchor">#</a> 添加从节点：replicate</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>cluster replicate <span class="token punctuation">[</span>主节点Id<span class="token punctuation">]</span>
<span class="token comment"># [主节点Id] 就是nodes显式的第一列，如30001端口445f2a86fe36d397613839d8cc1ae6702c976593</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="移除节点-forget"><a href="#移除节点-forget" class="header-anchor">#</a> 移除节点：forget</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>cluster forget [节点Id]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="重新分片-reshard"><a href="#重新分片-reshard" class="header-anchor">#</a> 重新分片：reshard</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 这是一个交互式的命令</span>
redis-cli <span class="token parameter variable">--cluster</span> reshard <span class="token punctuation">[</span>IP:port<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">127.0</span>.0.1:30007<span class="token punctuation">)</span>
<span class="token comment"># ...</span>
<span class="token comment"># [OK] All nodes agree about slots configuration.</span>
<span class="token comment"># 移动多少slots</span>
How many slots <span class="token keyword">do</span> you want to move <span class="token punctuation">(</span>from <span class="token number">1</span> to <span class="token number">16384</span><span class="token punctuation">)</span>? <span class="token number">4000</span>
<span class="token comment"># 分配给谁</span>
What is the receiving <span class="token function">node</span> ID?df0190853a53d8e078205d0e2fa56046f20362a7
<span class="token comment"># 原slots属于谁</span>
Please enter all the <span class="token builtin class-name">source</span> <span class="token function">node</span> IDs.
  <span class="token comment"># 提示信息</span>
  Type <span class="token string">'all'</span> to use all the nodes as <span class="token builtin class-name">source</span> nodes <span class="token keyword">for</span> the <span class="token builtin class-name">hash</span> slots.
  Type <span class="token string">'done'</span> once you entered all the <span class="token builtin class-name">source</span> nodes IDs.
<span class="token comment"># ... 转移slots信息</span>
Moving slot <span class="token number">2665</span> from 887397e6fefe8ad19ea7569e99f5eb8a803e3785
<span class="token comment"># 确认转移</span>
Do you want to proceed with the proposed reshard plan <span class="token punctuation">(</span>yes/no<span class="token punctuation">)</span>? <span class="token function">yes</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>reshard依赖Ruby环境。</p> <p>出现 <code>/usr/bin/env: ruby: No such file or directory</code> 错误，表明需要依赖 Ruby 环境，可使用命令 <code>yum install ruby</code> 安装 Ruby 环境即可。</p> <h4 id="负载均衡-rebalance"><a href="#负载均衡-rebalance" class="header-anchor">#</a> 负载均衡：rebalance</h4> <p>rebalance会根据访问量自动进行负载均衡。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>redis-cli <span class="token parameter variable">--cluster</span> rebalance <span class="token punctuation">[</span>IP:port<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">127.0</span>.0.1:30007<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="手动分片-addslots"><a href="#手动分片-addslots" class="header-anchor">#</a> 手动分片：addslots</h4> <h2 id="集群模式对涉及多个-key-的操作的影响"><a href="#集群模式对涉及多个-key-的操作的影响" class="header-anchor">#</a> 集群模式对涉及多个 key 的操作的影响</h2> <p>默认情况下，集群模式的 Lua 不能够跨 slots 访问数据，否则会得到如下错误：</p> <blockquote><p>Lua script attempted to access keys of different hash slots</p></blockquote> <p>集群模式下，Lua 脚本默认有一个限制，即一个 Lua 脚本操作的所有 key 必须在同一个slot上，即便操作的所有 key 都在同一个节点上，也会报错，必须是 slot。更广泛地说，所有涉及多个 key 的操作，在 Redis 集群模式下，这些 key 都必须映射到同一个slot上。比如 Lua、Redis 事务等等。</p> <h3 id="为什么是-slot-而非-node"><a href="#为什么是-slot-而非-node" class="header-anchor">#</a> 为什么是 slot 而非 node</h3> <p>即：为什么 Lua 不能够在同一个 node 的不同 slots 上操作多个 key 呢？</p> <p>因为，slot 的目的就是为了解耦 Redis 实例与数据的关系的。slot 应该可以在不同分片节点上进行切换以实现负载均衡。如果是分片而非 slot ，那么很有可能，你的代码今天能运行，明天就会爆炸。</p> <p>有意思的是，在以前的官方文档上，也误使用了 node 而非 slot 表达，因此，在此强调一下。</p> <p><img src="/blog/assets/img/image-20240114163115469.32dfeaa6.png" alt="image-20240114163115469"></p> <h2 id="解决方案"><a href="#解决方案" class="header-anchor">#</a> 解决方案</h2> <h3 id="_1、hashtags-保证-key-在同一节点"><a href="#_1、hashtags-保证-key-在同一节点" class="header-anchor">#</a> 1、HashTags：保证 key 在同一节点</h3> <p>如果键中的{}括号之间有子串，则只对字符串内的内容进行哈希处理，这个子串叫做「哈希标签」。</p> <p>例如：Redis 保证 <code>user:{123}:profile</code> 和 <code>user:{123}:account</code> 会在同一个哈希槽中，因为它们的「哈希标签」是相同的。</p> <p>通过 <code>CLUSTER KEYSLOT</code> 命令获取目标Key的哈希槽（Hash Slot）进行确认。</p> <h3 id="_2、考虑数据类型的设计"><a href="#_2、考虑数据类型的设计" class="header-anchor">#</a> 2、考虑数据类型的设计</h3> <p>我们可以使用 hashes, lists, or sets 等数据结构来保存有关联的数据，使得 Lua 无需跨 slots 访问数据，一个 Key 即可解决。</p> <h3 id="_3、eval-flags-allow-cross-slot-keys"><a href="#_3、eval-flags-allow-cross-slot-keys" class="header-anchor">#</a> 3、Eval Flags：allow-cross-slot-keys</h3> <p>Redis 7.0 提供了 <code>Eval flags</code> 可以告知 Redis 脚本的行为，基本使用如下：</p> <div class="language-lua line-numbers-mode"><pre class="language-lua"><code><span class="token comment">#!lua flags=no-writes,allow-stale</span>
<span class="token keyword">local</span> x <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'get'</span><span class="token punctuation">,</span><span class="token string">'x'</span><span class="token punctuation">)</span>
<span class="token keyword">return</span> x
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p>只要 Redis 发现 <code>#!</code> ，就会获得一些默认的 lua flags，这和没有 <code>#!</code> 的 Lua 脚本不同</p> <p>Redis 默认脚本有如下特性：</p> <ol><li>既有读操作，又有写操作</li> <li>可以运行在集群模式下，但不能跨 slots 访问数据</li> <li>从节点数据可能过时，会被拒绝操作从节点</li> <li>内存空间小时，会拒绝执行来避免内存溢出</li></ol></blockquote> <p>利用 Redis 7.0 新特性 Eval flags，允许脚本访问来自不同slots的keys，尽管这种做法是不推荐的。</p> <div class="language-lua line-numbers-mode"><pre class="language-lua"><code><span class="token comment">#!lua flags=allow-cross-slot-keys</span>
<span class="token operator">#</span> 允许脚本访问来自不同slots的keys
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_4、考虑不使用集群模式"><a href="#_4、考虑不使用集群模式" class="header-anchor">#</a> 4、考虑不使用集群模式</h3> <p>如果集群模式不是必须的，可以考虑不使用集群模式，自然就不会有这样的问题了。</p> <h4 id="参考文档"><a href="#参考文档" class="header-anchor">#</a> 参考文档</h4> <p>《Redis 核心技术与实战》</p> <p>《Redis 核心原理与实战》</p> <p><a href="https://redis.io/docs/interact/transactions/" target="_blank" rel="noopener noreferrer">Redis 官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://redis.com/blog/you-dont-need-transaction-rollbacks-in-redis/" target="_blank" rel="noopener noreferrer">You Don’t Need Transaction Rollbacks in Redis<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.dragonflydb.io/error-solutions/crossslot-keys-in-request-dont-hash-to-the-same-slot" target="_blank" rel="noopener noreferrer">Error: crossslot keys in request don't hash to the same slot<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/redis/redis/issues/5118" target="_blank" rel="noopener noreferrer">CROSSSLOT error on single-shard cluster<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/redis/high_availability/Sentinel.html" class="prev">
        哨兵（Sentinel）
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.7b9df32b.js" defer></script><script src="/blog/assets/js/2.be714ec7.js" defer></script><script src="/blog/assets/js/1.26c7c9cc.js" defer></script><script src="/blog/assets/js/45.b3e8ede1.js" defer></script>
  </body>
</html>
